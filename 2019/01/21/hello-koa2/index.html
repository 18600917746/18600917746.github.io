<!DOCTYPE html><html lang="zh-cn"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><title>hello-koa2 | 腹有诗书气自华</title><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="author" content="[object Object]"><meta name="designer" content="minfive"><meta name="keywords" content="前端博客, 前端, 程序员, 前端开发, vue, node.js, javascript"><meta name="description" content="日常学习与兴趣交流的个人博客"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=yes"><meta name="mobile-web-app-capable" content="yes"><meta name="robots" content="all"><link rel="canonical" href="https://18600917746.github.io/2019/01/21/hello-koa2/index.html"><link rel="icon" type="image/png" href="/images/favicon.ico" sizes="32x32"><link rel="stylesheet" href="/scss/base/index.css"><link rel="alternate" href="/atom.xml" title="cheng"><link rel="stylesheet" href="/scss/views/page/post.css"></head><body ontouchstart=""><div id="page-loading" class="page page-loading" style="background-image:url(/images/loader.gif)"></div><div id="page" class="page js-hidden"><header class="page__small-header page__header--small"><nav class="page__navbar"><div class="page__container navbar-container"><a class="page__logo" href="/" title="cheng" alt="cheng"><img src="/images/images.jpeg" alt="cheng"></a><nav class="page__nav"><ul class="nav__list clearfix"><li class="nav__item"><a href="/" alt="首页" title="首页">首页</a></li><li class="nav__item"><a href="/archives" alt="归档" title="归档">归档</a></li><li class="nav__item"><a href="/about" alt="关于" title="关于">关于</a></li></ul></nav><button class="page__menu-btn" type="button"><i class="iconfont icon-menu"></i></button></div></nav></header><main class="page__container page__main"><div class="page__content"><article class="page__post"><div class="post__cover"><img src="/images/default-bg.jpg" alt="hello-koa2"></div><header class="post__info"><h1 class="post__title">hello-koa2</h1><div class="post__mark"><div class="mark__block"><i class="mark__icon iconfont icon-write"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="/">cheng</a></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-time"></i><ul class="mark__list clearfix"><li class="mark__item"><span>2019-01-21</span></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-tab"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="/tags/Koa2/">Koa2</a></li><li class="mark__item"><a href="/tags/NodeJS/">NodeJS</a></li></ul></div></div></header><div class="post__content"><h2 id="koa入手先知"><a href="#koa入手先知" class="headerlink" title="koa入手先知"></a>koa入手先知</h2><p><code>Koa</code> 是一个新的 <code>web</code> 框架，由 <code>Express</code> 幕后的原班人马打造， 致力于成为 <code>web</code> 应用和 <code>API</code> 开发领域中的一个更小、更富有表现力、更健壮的基石。 通过利用 <code>async</code> 函数，<code>Koa</code> 帮你丢弃回调函数，并有力地增强错误处理。 <code>Koa</code> 并没有捆绑任何中间件， 而是提供了一套优雅的方法，帮助您快速而愉快地编写服务端应用程序。</p><ul><li><code>koa</code>的<code>路由中间件</code>需要安装<code>koa-router</code>模块来实现</li></ul><h3 id="koa安装"><a href="#koa安装" class="headerlink" title="koa安装"></a>koa安装</h3><ul><li>首先你要确定你已经安装的nodeJS</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node -v</span><br></pre></td></tr></table></figure><ul><li>创建空文件夹并初始化package.json包管理配置文件</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir mykoa</span><br><span class="line">cd myapp</span><br><span class="line">npm init</span><br></pre></td></tr></table></figure><ul><li>安装<code>koa2</code>包</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install koa --save</span><br><span class="line">npm install koa-router --save</span><br></pre></td></tr></table></figure><h3 id="通过koa启动一个简单的server服务"><a href="#通过koa启动一个简单的server服务" class="headerlink" title="通过koa启动一个简单的server服务"></a>通过<code>koa</code>启动一个简单的<code>server</code>服务</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">'koa'</span>);</span><br><span class="line"><span class="keyword">const</span> router = <span class="built_in">require</span>(<span class="string">'koa-router'</span>)();</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">'/'</span>, <span class="keyword">async</span> ctx =&gt; &#123;</span><br><span class="line">  ctx.body = <span class="string">'Hello koa2'</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.use(router.routes()).use(router.allowedMethods());</span><br><span class="line">app.listen(<span class="number">3000</span>, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'服务已开启'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="koa应用生成器"><a href="#koa应用生成器" class="headerlink" title="koa应用生成器"></a>koa应用生成器</h3><ul><li>使用koa社区比较活跃的方式生成与<code>express-generator</code>类似的框架</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g koa-generator</span><br></pre></td></tr></table></figure><ul><li>koa-generator支持<code>1.x</code>与<code>2.x</code>的生成【建议与时俱进】</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">koa2 myapp</span><br></pre></td></tr></table></figure><ul><li>安装依赖包</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd myapp</span><br><span class="line">npm install</span><br></pre></td></tr></table></figure><ul><li>启动服务</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm start</span><br></pre></td></tr></table></figure><h3 id="koa实例方法"><a href="#koa实例方法" class="headerlink" title="koa实例方法"></a>koa实例方法</h3><ul><li>app.use 注册中间件</li><li>app.callback 返回适用于 http.createServer() 方法的回调函数来处理请求</li><li>app.keys 设置签名的 Cookie 密钥</li><li>app.context app.context 是从其创建 ctx 的原型。您可以通过编辑 app.context 为 ctx 添加其他属性。</li><li>app.listen 绑定端口</li></ul><h3 id="koa核心成员-ctx"><a href="#koa核心成员-ctx" class="headerlink" title="koa核心成员 ctx"></a>koa核心成员 <code>ctx</code></h3><ul><li>Request<ul><li>ctx.req <code>node</code> 的 <code>request</code> 对象</li><li>ctx.request <code>koa</code> 的 <code>Request</code> 原始对象</li><li>ctx.header 请求标头对象</li><li>ctx.header= 设置请求标头对象</li><li>ctx.headers 请求标头对象【别名 ctx.header 】</li><li>ctx.headers= 设置标头对象【别名 ctx.header= 】</li><li>ctx.method 请求方法</li><li>ctx.method= 设置请求方法，对于实现诸如 <code>methodOverride()</code> 的中间件是有用的。</li><li>ctx.url 获取请求 <code>URL</code></li><li>ctx.url= 设置请求 <code>URL</code>, 对 <code>url</code> 重写有用。</li><li>ctx.originalUrl 获取请求原始URL。</li><li>ctx.origin 获取 <code>URL</code> 的来源，包括 <code>protocol</code> 和 <code>host</code>。</li><li>ctx.href 获取完整的链接地址</li><li>ctx.length 返回以数字返回请求的 <code>Content-Length</code>，或 <code>undefined</code>。</li><li>ctx.path 获取请求路径名。</li><li>ctx.path= 设置请求路径名，并在存在时保留查询字符串。</li><li>ctx.query 获取解析的查询字符串, 当没有查询字符串时，返回一个空对象。</li><li>ctx.query= 将查询字符串设置为给定对象。</li><li>ctx.querystring 根据 ? 获取原始查询字符串.</li><li>ctx.querystring= 设置原始查询字符串。</li><li>ctx.host 获取当前主机<code>（hostname:port）</code>。当 <code>app.proxy</code> 是 <code>true</code> 时支持 <code>X-Forwarded-Host</code>，否则使用 <code>Host</code>。</li><li>ctx.charset 在存在时获取请求字符集，或者 undefined</li><li>ctx.hostname 存在时获取主机名。当 <code>app.proxy</code> 是 <code>true</code> 时支持 <code>X-Forwarded-Host</code>，否则使用 <code>Host</code>。</li><li>ctx.fresh 检查请求缓存是否<code>“新鲜”</code>，也就是内容没有改变。此方法用于 <code>If-None-Match / ETag</code>, 和 <code>If-Modified-Since</code> 和 <code>Last-Modified</code> 之间的缓存协商。 在设置一个或多个这些响应头后应该引用它。</li><li>ctx.stale 与 <code>request.fresh</code> 相反</li><li>ctx.search 根据 <code>?</code> 获取原始查询字符串【不包括 <code>？</code> 】</li><li>ctx.socket 返回请求套接字。</li><li>ctx.protocol 返回请求协议，<code>“https”</code> 或 <code>“http”</code>。当 <code>app.proxy</code> 是 <code>true</code> 时支持 <code>X-Forwarded-Proto</code>。</li><li>ctx.secure 通过 ctx.protocol == “https” 来检查请求是否通过 TLS 发出。</li><li>ctx.ip 请求远程地址。 当 app.proxy 是 true 时支持 X-Forwarded-Proto。</li><li>ctx.ips 当 <code>X-Forwarded-For</code> 存在并且 <code>app.proxy</code> 被启用时，这些 <code>ips</code> 的数组被返回，从上游 - &gt;下游排序。 禁用时返回一个空数组。</li><li>ctx.subdomains 将子域返回为数组。</li><li>ctx.is()</li><li>ctx.type= 设置返回的数据类型</li><li>ctx.type 获取请求 <code>Content-Type</code> 不含参数 <code>&quot;charset&quot;</code>。</li><li>ctx.accepts()</li><li>ctx.acceptsEncodings()</li><li>ctx.acceptsCharsets()</li><li>ctx.acceptsLanguages()</li><li>ctx.get()</li></ul></li><li>Response<ul><li>ctx.res <code>node</code> 的 <code>request</code> 对象</li><li>ctx.response <code>koa</code> 的 <code>Response</code> 对象【推荐使用】</li><li>ctx.body=</li><li>ctx.status=</li><li>ctx.message=</li><li>ctx.length= 返回以数字返回请求的 Content-Length，或 undefined。</li><li>ctx.type= 设置返回的数据类型</li><li>ctx.throw() 设置错误信息返回给前台，并终止程序</li><li>ctx.assert() 断言判断</li><li>ctx.headerSent</li><li>ctx.redirect()</li><li>ctx.attachment()</li><li>ctx.set() 设置响应标头 field 到 value:</li><li>ctx.append()</li><li>ctx.remove()</li><li>ctx.lastModified=</li><li>ctx.etag=</li></ul></li><li>state<ul><li>ctx.state 推荐使用的命名空间，可以挂载一些公用的数据</li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.state.user = <span class="keyword">await</span> User.find(id);</span><br></pre></td></tr></table></figure><ul><li><p>cookies</p><ul><li>ctx.cookies.get 获取 <code>cookie</code> 的 <code>name</code></li><li>ctx.cookies.set 设置 <code>cookie</code> 的相关信息<ul><li>axAge 一个数字表示从 <code>Date.now()</code> 得到的毫秒数</li><li>signed cookie 签名值</li><li>expires cookie 过期的 Date</li><li>path cookie 路径, 默认是<code>&#39;/&#39;</code></li><li>domain <code>cookie</code> 域名</li><li>secure 安全 <code>cookie</code></li><li>httpOnly 服务器可访问 <code>cookie</code>, 默认是 <code>true</code></li><li>overwrite 一个布尔值，表示是否覆盖以前设置的同名的 <code>cookie</code> (默认是 <code>false</code>). 如果是 <code>true</code>, 在同一个请求中设置相同名称的所有 <code>Cookie</code>（不管路径或域）是否在设置此 <code>Cookie</code> 时从 <code>Set-Cookie</code> 标头中过滤掉。</li></ul></li></ul></li><li><p>throw</p><ul><li>ctx.throw 创建错误 - <a href="https://github.com/jshttp/http-errors" target="_blank" rel="noopener">http-errors</a></li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ctx.throw(<span class="number">400</span>);</span><br><span class="line">ctx.throw(<span class="number">400</span>, <span class="string">'name required'</span>);</span><br><span class="line">ctx.throw(<span class="number">400</span>, <span class="string">'name required'</span>, &#123; <span class="attr">user</span>: user &#125;);</span><br></pre></td></tr></table></figure><ul><li>assert<ul><li>ctx.assert 断言模块 - <a href="https://github.com/jshttp/http-assert" target="_blank" rel="noopener">http-assert</a></li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.assert(ctx.state.user, <span class="number">401</span>, <span class="string">'User not found. Please login!'</span>);</span><br></pre></td></tr></table></figure><h3 id="同一个应用程序同时作为-HTTP-和-HTTPS-或多个地址"><a href="#同一个应用程序同时作为-HTTP-和-HTTPS-或多个地址" class="headerlink" title="同一个应用程序同时作为 HTTP 和 HTTPS 或多个地址"></a>同一个应用程序同时作为 HTTP 和 HTTPS 或多个地址</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">const</span> https = <span class="built_in">require</span>(<span class="string">'https'</span>);</span><br><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">'koa'</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line">http.createServer(app.callback()).listen(<span class="number">3000</span>);</span><br><span class="line">https.createServer(app.callback()).listen(<span class="number">3001</span>);</span><br></pre></td></tr></table></figure><h3 id="koa-最经典的-洋葱模型"><a href="#koa-最经典的-洋葱模型" class="headerlink" title="koa 最经典的 洋葱模型"></a>koa 最经典的 洋葱模型</h3><ul><li>使用 <code>next()</code> 向下传递的时候一定要使用 <code>await</code> 去修饰</li></ul><p><img src="./koa.png" alt=""><br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">app.use(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">await</span> next();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.use(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">3</span>);</span><br><span class="line">  <span class="keyword">await</span> next();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">4</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.use(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">5</span>);</span><br><span class="line">  <span class="keyword">await</span> next();</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">6</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// 3</span></span><br><span class="line"><span class="comment">// 5</span></span><br><span class="line"><span class="comment">// 6</span></span><br><span class="line"><span class="comment">// 4</span></span><br><span class="line"><span class="comment">// 2</span></span><br></pre></td></tr></table></figure><p></p><h3 id="koa-静态资源处理"><a href="#koa-静态资源处理" class="headerlink" title="koa 静态资源处理"></a>koa 静态资源处理</h3><ul><li>使用第三方中间件 <code>koa-static</code><ul><li>maxage 缓存时间</li><li>index 默认文件</li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install koa-static -D</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> koa = <span class="built_in">require</span>(<span class="string">'koa'</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">static</span> = <span class="built_in">require</span>(<span class="string">'koa-static'</span>);</span><br><span class="line"><span class="keyword">const</span> server = <span class="keyword">new</span> koa();</span><br><span class="line">server.listen(<span class="number">8080</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">server.use(<span class="keyword">static</span>(<span class="string">'./static'</span>,&#123;</span><br><span class="line">  maxage: <span class="number">84600</span>*<span class="number">1000</span>,</span><br><span class="line">  index:<span class="string">'index.html'</span></span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure><h3 id="根据文件类型做-静态资源缓存"><a href="#根据文件类型做-静态资源缓存" class="headerlink" title="根据文件类型做 静态资源缓存"></a>根据文件类型做 <code>静态资源缓存</code></h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> staticRouter = <span class="keyword">new</span> Router();</span><br><span class="line"></span><br><span class="line">staticRouter.all(<span class="regexp">/(\.jpg|\.gif|\.png)$/i</span>, <span class="keyword">static</span>(<span class="string">'./static'</span>, &#123;</span><br><span class="line">  maxage: <span class="number">60</span> * <span class="number">86400</span> * <span class="number">1000</span>,</span><br><span class="line">&#125;));</span><br><span class="line">staticRouter.all(<span class="regexp">/(\.css)$/i</span>, <span class="keyword">static</span>(<span class="string">'./static'</span>, &#123;</span><br><span class="line">  maxage: <span class="number">10</span> * <span class="number">86400</span> * <span class="number">1000</span>,</span><br><span class="line">&#125;));</span><br><span class="line">staticRouter.all(<span class="regexp">/(\.html|\.htm|\.xhtml)$/i</span>, <span class="keyword">static</span>(<span class="string">'./static'</span>, &#123;</span><br><span class="line">  maxage: <span class="number">20</span> * <span class="number">86400</span> * <span class="number">1000</span>,</span><br><span class="line">&#125;));</span><br><span class="line"><span class="comment">// 其他文件统一缓存 30 天</span></span><br><span class="line">staticRouter.all(<span class="string">''</span>, <span class="keyword">static</span>(<span class="string">'./static'</span>, &#123;</span><br><span class="line">  maxage: <span class="number">30</span> * <span class="number">86400</span> * <span class="number">1000</span>,</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure><h3 id="koa-处理-get-请求"><a href="#koa-处理-get-请求" class="headerlink" title="koa 处理 get 请求"></a>koa 处理 get 请求</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">'/get'</span>, <span class="keyword">async</span> ctx =&gt; &#123;</span><br><span class="line">  ctx.body = &#123;</span><br><span class="line">    req: ctx.request.query,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="koa-处理-动态路由-请求"><a href="#koa-处理-动态路由-请求" class="headerlink" title="koa 处理 动态路由 请求"></a>koa 处理 动态路由 请求</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">'/get/:id'</span>, <span class="keyword">async</span> ctx =&gt; &#123;</span><br><span class="line">  ctx.body = &#123;</span><br><span class="line">    req: ctx.params.id,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="get-传参与-动态路由-的区别"><a href="#get-传参与-动态路由-的区别" class="headerlink" title="get 传参与 动态路由 的区别"></a>get 传参与 动态路由 的区别</h3><ul><li>get 传参 （urlencoded）<ul><li>顺序可以调整</li><li>参数可以省略</li><li>不利于 <code>SEO</code></li></ul></li><li>params 传参（动态路由）<ul><li>顺序固定</li><li>参数固定</li><li>利于 <code>SEO</code></li></ul></li></ul><h3 id="koa-处理-post-请求"><a href="#koa-处理-post-请求" class="headerlink" title="koa 处理 post 请求"></a>koa 处理 post 请求</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">'koa-bodyparser'</span>);</span><br><span class="line">app.use(bodyParser());</span><br><span class="line">router.post(<span class="string">'/post'</span>, <span class="keyword">async</span> ctx =&gt; &#123;</span><br><span class="line">  ctx.body = &#123;</span><br><span class="line">    req: ctx.request.body,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="koa-处理-图片-请求"><a href="#koa-处理-图片-请求" class="headerlink" title="koa 处理 图片 请求"></a>koa 处理 图片 请求</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs= <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line">router.get(<span class="string">'/koa'</span>, <span class="keyword">async</span> ctx =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'触发'</span>);</span><br><span class="line">  <span class="keyword">let</span> data = fs.createReadStream(<span class="string">'./public/koa.png'</span>);</span><br><span class="line">  ctx.type = <span class="string">'.png'</span>;</span><br><span class="line">  ctx.body = data;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="koa-处理-文件上传-请求"><a href="#koa-处理-文件上传-请求" class="headerlink" title="koa 处理 文件上传 请求"></a>koa 处理 文件上传 请求</h3><ul><li>使用 <code>form</code> 表单上传文件，一定要开启 <code>enctype=&quot;multipart/form-data&quot;</code></li><li>使用 <code>koa-better-body</code> 处理 post + 文件上传</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/upload"</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"file"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> koa = <span class="built_in">require</span>(<span class="string">'koa'</span>);</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">'koa-router'</span>);</span><br><span class="line"><span class="keyword">const</span> body = <span class="built_in">require</span>(<span class="string">'koa-better-body'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = <span class="keyword">new</span> koa();</span><br><span class="line">server.listen(<span class="number">8080</span>);</span><br><span class="line"></span><br><span class="line">server.use(body(&#123;</span><br><span class="line">  uploadDir: <span class="string">'./static/upload'</span>,</span><br><span class="line">&#125;));</span><br><span class="line">server.post(<span class="string">'/upload'</span>,<span class="keyword">async</span> ctx =&gt; &#123;</span><br><span class="line">  <span class="comment">// 文件与post 数据都在 request.fields</span></span><br><span class="line">  <span class="built_in">console</span>.log(ctx.request.fields);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="koa-处理-文件下载-请求"><a href="#koa-处理-文件下载-请求" class="headerlink" title="koa 处理 文件下载 请求"></a>koa 处理 文件下载 请求</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs= <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line">router.get(<span class="string">'/koa'</span>, <span class="keyword">async</span> ctx =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'触发'</span>);</span><br><span class="line">  <span class="keyword">let</span> data = fs.createReadStream(<span class="string">'./static/koa.txt'</span>);</span><br><span class="line">  ctx.type = <span class="string">'application/octet-stream'</span>;</span><br><span class="line">  ctx.body = data;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="koa-处理-cookie"><a href="#koa-处理-cookie" class="headerlink" title="koa 处理 cookie"></a>koa 处理 cookie</h3><ul><li>koa提供了从上下文直接读取、写入cookie的方法<ul><li>ctx.cookies.get(name, [options]) 读取上下文请求中的cookie</li><li>ctx.cookies.set(name, value, [options]) 在上下文中写入cookie</li></ul></li><li>app.keys 设置签名的 Cookie 密钥<ul><li>ctx.cookies.set(‘user’,’blue’,{signed: true}) 设置的时候需要开启</li><li>ctx.cookies.get(‘user’,{signed: true}) 获取的时候也要开启</li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取 cookie</span></span><br><span class="line"><span class="keyword">const</span> koa =<span class="built_in">require</span>(<span class="string">'koa'</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> koa();</span><br><span class="line">app.keys =[<span class="string">'123'</span>,<span class="string">'123'</span>,<span class="string">'1231'</span>];</span><br><span class="line"><span class="keyword">let</span> cid = ctx.cookies.get(<span class="string">'cid'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置 cookie </span></span><br><span class="line">app.use(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (ctx.url === <span class="string">'/index'</span>) &#123;</span><br><span class="line">    ctx.cookies.set(</span><br><span class="line">        <span class="string">'cid'</span>,</span><br><span class="line">        <span class="string">'9527'</span>,</span><br><span class="line">        &#123;</span><br><span class="line">          domain: <span class="string">'localhost'</span>,  <span class="comment">// 写cookie所在的域名</span></span><br><span class="line">          path: <span class="string">'/index'</span>,       <span class="comment">// 写cookie所在的路径</span></span><br><span class="line">          maxAge: <span class="number">10</span> * <span class="number">60</span> * <span class="number">1000</span>, <span class="comment">// cookie有效时长</span></span><br><span class="line">          expires: <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">'2017-02-15'</span>),  <span class="comment">// cookie失效时间</span></span><br><span class="line">          httpOnly: <span class="literal">false</span>,  <span class="comment">// 是否只用于http请求中获取</span></span><br><span class="line">          overwrite: <span class="literal">false</span>,  <span class="comment">// 是否允许重写</span></span><br><span class="line">          signed: <span class="literal">true</span> <span class="comment">// 是否使用 keys 进行认证加密</span></span><br><span class="line">        &#125;,</span><br><span class="line">    );</span><br><span class="line">    ctx.body = <span class="string">'cookie is ok'</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> next();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="koa-实现session"><a href="#koa-实现session" class="headerlink" title="koa 实现session"></a>koa 实现session</h3><ul><li>koa2 只提供了 <code>cookie</code> 没有原生的提供 <code>session</code> 所以需要自己编写或者使用第三方插件<ul><li>如果session数据量很小，可以直接存在内存中</li><li>如果session数据量很大，则需要存储介质存放session数据</li></ul></li><li>数据库存储方案<ul><li>将session存放在MySQL数据库中</li><li>需要用到中间件<ul><li>koa-session-minimal 适用于koa2 的session中间件，提供存储介质的读写接口 。</li><li>koa-mysql-session 为koa-session-minimal中间件提供MySQL数据库的session数据读写操作。</li><li>将sessionId和对于的数据存到数据库</li></ul></li><li>将数据库的存储的sessionId存到页面的cookie中 【不建议】</li><li>根据cookie的sessionId去获取对于的session信息</li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">'koa'</span>);</span><br><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">'koa-session-minimal'</span>);</span><br><span class="line"><span class="keyword">const</span> MysqlSession = <span class="built_in">require</span>(<span class="string">'koa-mysql-session'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置存储session信息的mysql</span></span><br><span class="line"><span class="keyword">let</span> store = <span class="keyword">new</span> MysqlSession(&#123;</span><br><span class="line">  user: <span class="string">'root'</span>,</span><br><span class="line">  password: <span class="string">'abc123'</span>,</span><br><span class="line">  database: <span class="string">'koa_demo'</span>,</span><br><span class="line">  host: <span class="string">'127.0.0.1'</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 存放sessionId的cookie配置</span></span><br><span class="line"><span class="keyword">let</span> cookie = &#123;</span><br><span class="line">  maxAge: <span class="string">''</span>, <span class="comment">// cookie有效时长</span></span><br><span class="line">  expires: <span class="string">''</span>,  <span class="comment">// cookie失效时间</span></span><br><span class="line">  path: <span class="string">''</span>, <span class="comment">// 写cookie所在的路径</span></span><br><span class="line">  domain: <span class="string">''</span>, <span class="comment">// 写cookie所在的域名</span></span><br><span class="line">  httpOnly: <span class="string">''</span>, <span class="comment">// 是否只用于http请求中获取</span></span><br><span class="line">  overwrite: <span class="string">''</span>,  <span class="comment">// 是否允许重写</span></span><br><span class="line">  secure: <span class="string">''</span>,</span><br><span class="line">  sameSite: <span class="string">''</span>,</span><br><span class="line">  signed: <span class="string">''</span>, <span class="comment">// 是否使用 keys 认证加密</span></span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用session中间件</span></span><br><span class="line">app.use(session(&#123;</span><br><span class="line">  key: <span class="string">'SESSION_ID'</span>,</span><br><span class="line">  store: store,</span><br><span class="line">  cookie: cookie</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line">app.use( <span class="keyword">async</span> ( ctx ) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设置session</span></span><br><span class="line">  <span class="keyword">if</span> ( ctx.url === <span class="string">'/set'</span> ) &#123;</span><br><span class="line">    ctx.session = &#123;</span><br><span class="line">      user_id: <span class="built_in">Math</span>.random().toString(<span class="number">36</span>).substr(<span class="number">2</span>),</span><br><span class="line">      count: <span class="number">0</span></span><br><span class="line">    &#125;;</span><br><span class="line">    ctx.body = ctx.session</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( ctx.url === <span class="string">'/'</span> ) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读取session信息</span></span><br><span class="line">    ctx.session.count = ctx.session.count + <span class="number">1</span>;</span><br><span class="line">    ctx.body = ctx.session</span><br><span class="line">  &#125; </span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'[demo] session is starting at port 3000'</span>)</span><br><span class="line"><span class="string">``</span><span class="string">` </span></span><br><span class="line"><span class="string">### koa 处理 跨域</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### koa 处理 jsonp</span></span><br><span class="line"><span class="string">- 使用第三方控件</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>npm</span><br><span class="line">npm install koa-jsonp --save</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> jsonp = <span class="built_in">require</span>(<span class="string">'koa-jsonp'</span>);</span><br><span class="line">app.use(jsonp());</span><br><span class="line">app.use( <span class="keyword">async</span> ( ctx ) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> returnData = &#123;</span><br><span class="line">    success: <span class="literal">true</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      text: <span class="string">'this is a jsonp api'</span>,</span><br><span class="line">      time: <span class="keyword">new</span> <span class="built_in">Date</span>().getTime(),</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 直接输出JSON</span></span><br><span class="line">  ctx.body = &#123;</span><br><span class="line">    success: <span class="literal">true</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      text: <span class="string">'this is a jsonp api'</span>,</span><br><span class="line">      time: <span class="keyword">new</span> <span class="built_in">Date</span>().getTime(),</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="koa-模板引擎-【需要-views-中间件支持】"><a href="#koa-模板引擎-【需要-views-中间件支持】" class="headerlink" title="koa 模板引擎 【需要 views 中间件支持】"></a>koa 模板引擎 【需要 views 中间件支持】</h3><ul><li>安装 views 中间件</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save koa-views</span><br></pre></td></tr></table></figure><ul><li>ejs</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install ejs --save</span><br></pre></td></tr></table></figure><ul><li>设置渲染引擎</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.use(views(path.join(__dirname, <span class="string">'./views'</span>), &#123;</span><br><span class="line">  extension: <span class="string">'ejs'</span>,</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure><ul><li>创建一个简单的index.ejs骨架</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;<span class="name">%=</span> <span class="attr">title</span> %&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">%=</span> <span class="attr">message</span> %&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>根据路由传递参数，并渲染页面</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">'/ejs'</span>, <span class="keyword">async</span> ctx =&gt; &#123;</span><br><span class="line">  <span class="keyword">await</span> ctx.render(<span class="string">'ejs'</span>, &#123;</span><br><span class="line">    title: <span class="string">'ejs'</span>,</span><br><span class="line">    message: <span class="string">'Hello koa - ejs'</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="koa-进行测试"><a href="#koa-进行测试" class="headerlink" title="koa 进行测试"></a>koa 进行测试</h3><ul><li>第三方相关库<ul><li>mocha 模块是测试框架</li><li>chai 模块是用来进行测试结果断言库，比如一个判断 1 + 1 是否等于 2</li><li>supertest 模块是http请求测试库，用来请求API接口</li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install mocha chai supertest --save-dev</span><br></pre></td></tr></table></figure><ul><li>编写测试用例</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// test/index.test.js</span></span><br><span class="line"><span class="keyword">const</span> supertest = <span class="built_in">require</span>(<span class="string">'supertest'</span>);</span><br><span class="line"><span class="keyword">const</span> chai = <span class="built_in">require</span>(<span class="string">'chai'</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="built_in">require</span>(<span class="string">'./../index'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> expect = chai.expect;</span><br><span class="line"><span class="keyword">const</span> request = supertest( app.listen() );</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试套件/组</span></span><br><span class="line">describe( <span class="string">'开始测试demo的GET请求'</span>, ( ) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 测试用例</span></span><br><span class="line">  it(<span class="string">'测试/getString.json请求'</span>, ( done ) =&gt; &#123;</span><br><span class="line">      request</span><br><span class="line">        .get(<span class="string">'/getString.json'</span>)</span><br><span class="line">        .expect(<span class="number">200</span>)</span><br><span class="line">        .end(<span class="function">(<span class="params"> err, res </span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 断言判断结果是否为object类型</span></span><br><span class="line">            expect(res.body).to.be.an(<span class="string">'object'</span>);</span><br><span class="line">            expect(res.body.success).to.be.an(<span class="string">'boolean'</span>);</span><br><span class="line">            expect(res.body.data).to.be.an(<span class="string">'string'</span>);</span><br><span class="line">            done()</span><br><span class="line">        &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>执行测试用例<ul><li>如果使用的是 <code>webstrom</code> 可以配置执行脚本</li><li>如果全局安装的 <code>mocha</code> 可在当前文件夹直接执行 <code>mocha</code></li><li>如果是临时安装 需要执行 <code>./node_modules/.bin/mocha</code></li></ul></li></ul><h3 id="经典目录架构"><a href="#经典目录架构" class="headerlink" title="经典目录架构"></a>经典目录架构</h3><p><img src="./koaDir.jpg" alt=""></p><h3 id="通过-session-来进行用户登录权限判断"><a href="#通过-session-来进行用户登录权限判断" class="headerlink" title="通过 session 来进行用户登录权限判断"></a>通过 session 来进行用户登录权限判断</h3><ul><li>使用 <code>session</code> 中间件</li><li>登录以后存储 <code>session</code> 并设置</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> session = ctx.session;</span><br><span class="line">session.isLogin = <span class="literal">true</span>;</span><br><span class="line">session.userName = userResult.name;</span><br><span class="line">session.userId = userResult.id;</span><br></pre></td></tr></table></figure><ul><li>做路由判断</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 判断是否有session</span></span><br><span class="line"><span class="keyword">if</span> ( ctx.session &amp;&amp; ctx.session.isLogin &amp;&amp; ctx.session.userName ) &#123;</span><br><span class="line">  <span class="keyword">const</span> title = <span class="string">'work页面'</span>;</span><br><span class="line">   ctx.render(<span class="string">'work'</span>, &#123;</span><br><span class="line">    title,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// 没有登录态则跳转到错误页面</span></span><br><span class="line">  ctx.redirect(<span class="string">'/error'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="koa-与-mysql-结合"><a href="#koa-与-mysql-结合" class="headerlink" title="koa 与 mysql 结合"></a>koa 与 mysql 结合</h3><ul><li>使用 co-mysql 进行 async 异步的同步式编写</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> koa = <span class="built_in">require</span>(<span class="string">'koa'</span>);</span><br><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">'mysql'</span>);</span><br><span class="line"><span class="keyword">const</span> co = <span class="built_in">require</span>(<span class="string">'co-mysql'</span>);</span><br><span class="line"><span class="keyword">const</span> router = <span class="built_in">require</span>(<span class="string">'koa-router'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = <span class="keyword">new</span> koa();</span><br><span class="line"><span class="keyword">let</span> conn = mysql.createPool(&#123;</span><br><span class="line">  host: <span class="string">'localhost'</span>,</span><br><span class="line">  port: <span class="number">3306</span>,</span><br><span class="line">  user: <span class="string">'root'</span>,</span><br><span class="line">  password: <span class="string">'121'</span>,</span><br><span class="line">  database: <span class="string">'20181101'</span>,</span><br><span class="line">&#125;);</span><br><span class="line">server.listen(<span class="number">8080</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> db = co(conn);</span><br><span class="line"><span class="comment">// 添加到 实例里面是为了 模块化 直接使用</span></span><br><span class="line">server.context.db = db;</span><br><span class="line"></span><br><span class="line">server.get(<span class="string">'/list'</span>, <span class="keyword">async</span> ctx =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> data = <span class="keyword">await</span> ctx.db.query(<span class="string">'SELECT * FORM item_table'</span>);</span><br><span class="line">  ctx.body = data;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.use(router.routes()).use(router.allowedMethods());</span><br><span class="line"><span class="string">``</span><span class="string">` </span></span><br><span class="line"><span class="string">### 错误处理</span></span><br><span class="line"><span class="string">- 使用 try catch 进行异步错误拦截</span></span><br><span class="line"><span class="string">    - 使用 server.use</span></span><br><span class="line"><span class="string">    - 使用 router.all </span></span><br><span class="line"><span class="string">    - 单模块内使用 拦截</span></span><br><span class="line"><span class="string">    - 外部统一拦截</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>javascript</span><br><span class="line"><span class="keyword">const</span> koa = <span class="built_in">require</span>(<span class="string">'koa'</span>);</span><br><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">'mysql'</span>);</span><br><span class="line"><span class="keyword">const</span> co = <span class="built_in">require</span>(<span class="string">'co-mysql'</span>);</span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">'koa-router'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = <span class="keyword">new</span> koa();</span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router();</span><br><span class="line"><span class="keyword">let</span> conn = mysql.createPool(&#123;</span><br><span class="line">  host: <span class="string">'localhost'</span>,</span><br><span class="line">  port: <span class="number">3306</span>,</span><br><span class="line">  user: <span class="string">'root'</span>,</span><br><span class="line">  password: <span class="string">'121'</span>,</span><br><span class="line">  database: <span class="string">'20181101'</span>,</span><br><span class="line">&#125;);</span><br><span class="line">server.listen(<span class="number">8080</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> db = co(conn);</span><br><span class="line"><span class="comment">// 添加到 实例里面是为了 模块化 直接使用</span></span><br><span class="line">server.context.db = db;</span><br><span class="line"><span class="comment">// 统一处理 错误 避免 模块内遗漏 服务器出错</span></span><br><span class="line">server.use(<span class="keyword">async</span> (ctx,next)=&gt;&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> next();</span><br><span class="line">  &#125;<span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    ctx.body=e</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 或者使用 router.all 进行拦截</span></span><br><span class="line">router.all(<span class="string">'*'</span>, <span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> next();</span><br><span class="line">  &#125;<span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    ctx.body=e</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.get(<span class="string">'/list'</span>, <span class="keyword">async</span> ctx =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> data = <span class="keyword">await</span> ctx.db.query(<span class="string">'SELECT * FORM item_table'</span>);</span><br><span class="line">      ctx.body = data;</span><br><span class="line">  &#125;<span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(e);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.use(router.routes()).use(router.allowedMethods());</span><br></pre></td></tr></table></figure><div class="post-announce">感谢您的阅读，本文由 <a href="https://18600917746.github.io">cheng</a> 版权所有。如若转载，请注明出处：cheng（<a href="https://18600917746.github.io/2019/01/21/hello-koa2/">https://18600917746.github.io/2019/01/21/hello-koa2/</a>）</div><div class="post__prevs"><div class="post__prev"><a href="/2019/01/19/hello-express/" title="hello-express"><i class="iconfont icon-prev"></i>hello-express</a></div><div class="post__prev post__prev--right"><a href="/2019/01/21/node-js与io-js/" title="node.js与io.js">node.js与io.js<i class="iconfont icon-next"></i></a></div></div></div></article></div><aside class="page__sidebar"><form id="page-search-from" class="page__search-from" action="/search/"><label class="search-form__item"><input class="input" type="text" name="search" placeholder="Search..."> <i class="iconfont icon-search"></i></label></form><div class="sidebar__block"><h3 class="block__title">简介</h3><p class="block__text">日常学习与兴趣交流的个人博客</p></div><div class="sidebar__block"><h3 class="block__title">文章分类</h3><ul class="block-list"><li class="block-list-item"><a class="block-list-link" href="/categories/茶余饭后/">茶余饭后</a><span class="block-list-count">5</span><ul class="block-list-child"><li class="block-list-item"><a class="block-list-link" href="/categories/茶余饭后/文章/">文章</a><span class="block-list-count">2</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/茶余饭后/jsCode/">jsCode</a><span class="block-list-count">3</span></li></ul></li><li class="block-list-item"><a class="block-list-link" href="/categories/测试/">测试</a><span class="block-list-count">3</span><ul class="block-list-child"><li class="block-list-item"><a class="block-list-link" href="/categories/测试/hello/">hello</a><span class="block-list-count">3</span></li></ul></li><li class="block-list-item"><a class="block-list-link" href="/categories/小程序/">小程序</a><span class="block-list-count">1</span><ul class="block-list-child"><li class="block-list-item"><a class="block-list-link" href="/categories/小程序/原生/">原生</a><span class="block-list-count">1</span></li></ul></li><li class="block-list-item"><a class="block-list-link" href="/categories/后端/">后端</a><span class="block-list-count">8</span><ul class="block-list-child"><li class="block-list-item"><a class="block-list-link" href="/categories/后端/hello/">hello</a><span class="block-list-count">6</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/后端/Php/">Php</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/后端/Java/">Java</a><span class="block-list-count">1</span><ul class="block-list-child"><li class="block-list-item"><a class="block-list-link" href="/categories/后端/Java/Spring-Boot/">Spring Boot</a><span class="block-list-count">1</span></li></ul></li></ul></li><li class="block-list-item"><a class="block-list-link" href="/categories/前端/">前端</a><span class="block-list-count">23</span><ul class="block-list-child"><li class="block-list-item"><a class="block-list-link" href="/categories/前端/vue/">vue</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/前端/super/">super</a><span class="block-list-count">3</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/前端/hello/">hello</a><span class="block-list-count">15</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/前端/Js/">Js</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/前端/H5/">H5</a><span class="block-list-count">1</span></li></ul></li><li class="block-list-item"><a class="block-list-link" href="/categories/Dart/">Dart</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/Axios/">Axios</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/App/">App</a><span class="block-list-count">6</span><ul class="block-list-child"><li class="block-list-item"><a class="block-list-link" href="/categories/App/Flutter/">Flutter</a><span class="block-list-count">4</span><ul class="block-list-child"><li class="block-list-item"><a class="block-list-link" href="/categories/App/Flutter/SharedPreference/">SharedPreference</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/App/Flutter/Routes/">Routes</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/App/Flutter/Icon/">Icon</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/App/Flutter/Http/">Http</a><span class="block-list-count">1</span></li></ul></li><li class="block-list-item"><a class="block-list-link" href="/categories/App/Cordova/">Cordova</a><span class="block-list-count">2</span><ul class="block-list-child"><li class="block-list-item"><a class="block-list-link" href="/categories/App/Cordova/Plugin/">Plugin</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/App/Cordova/Platforms/">Platforms</a><span class="block-list-count">1</span></li></ul></li></ul></li></ul></div><div class="sidebar__block"><h3 class="block__title">最新文章</h3><ul class="block-list latest-post-list"><li class="latest-post-item"><a href="/2019/06/13/hello-java-http/" title="hello-java-http"><div class="item__cover"><img src="/images/default-bg.jpg" alt="hello-java-http"></div><div class="item__info"><h3 class="item__title">hello-java-http</h3><span class="item__text">2019-06-13</span></div></a></li><li class="latest-post-item"><a href="/2019/06/08/hello-dart/" title="hello-dart"><div class="item__cover"><img src="/images/default-bg.jpg" alt="hello-dart"></div><div class="item__info"><h3 class="item__title">hello-dart</h3><span class="item__text">2019-06-08</span></div></a></li><li class="latest-post-item"><a href="/2019/06/06/hello-jsSkill/" title="hello-jsSkill"><div class="item__cover"><img src="/images/default-bg.jpg" alt="hello-jsSkill"></div><div class="item__info"><h3 class="item__title">hello-jsSkill</h3><span class="item__text">2019-06-06</span></div></a></li><li class="latest-post-item"><a href="/2019/05/31/hello-flutter-SharedPreference/" title="hello-flutter-SharedPreference"><div class="item__cover"><img src="/images/default-bg.jpg" alt="hello-flutter-SharedPreference"></div><div class="item__info"><h3 class="item__title">hello-flutter-SharedPreference</h3><span class="item__text">2019-05-31</span></div></a></li></ul></div><div class="sidebar__block"><h3 class="block__title">文章标签</h3><ul class="block-list tag-list clearfix"><li class="tag-item"><a class="tag-link" href="/tags/Ajax/">Ajax</a></li><li class="tag-item"><a class="tag-link" href="/tags/Apache/">Apache</a></li><li class="tag-item"><a class="tag-link" href="/tags/App/">App</a></li><li class="tag-item"><a class="tag-link" href="/tags/Axios/">Axios</a></li><li class="tag-item"><a class="tag-link" href="/tags/Bugfree/">Bugfree</a></li><li class="tag-item"><a class="tag-link" href="/tags/Cordova/">Cordova</a></li><li class="tag-item"><a class="tag-link" href="/tags/Dart/">Dart</a></li><li class="tag-item"><a class="tag-link" href="/tags/ES6/">ES6</a></li><li class="tag-item"><a class="tag-link" href="/tags/Express/">Express</a></li><li class="tag-item"><a class="tag-link" href="/tags/Flutter/">Flutter</a></li><li class="tag-item"><a class="tag-link" href="/tags/Git-服务器/">Git 服务器</a></li><li class="tag-item"><a class="tag-link" href="/tags/H5/">H5</a></li><li class="tag-item"><a class="tag-link" href="/tags/Hash/">Hash</a></li><li class="tag-item"><a class="tag-link" href="/tags/Java/">Java</a></li><li class="tag-item"><a class="tag-link" href="/tags/Js片段/">Js片段</a></li><li class="tag-item"><a class="tag-link" href="/tags/Koa2/">Koa2</a></li><li class="tag-item"><a class="tag-link" href="/tags/Nginx/">Nginx</a></li><li class="tag-item"><a class="tag-link" href="/tags/Node/">Node</a></li><li class="tag-item"><a class="tag-link" href="/tags/NodeJS/">NodeJS</a></li><li class="tag-item"><a class="tag-link" href="/tags/Php/">Php</a></li><li class="tag-item"><a class="tag-link" href="/tags/Spring-Boot/">Spring Boot</a></li><li class="tag-item"><a class="tag-link" href="/tags/Svn-服务器/">Svn 服务器</a></li><li class="tag-item"><a class="tag-link" href="/tags/Tomcat/">Tomcat</a></li><li class="tag-item"><a class="tag-link" href="/tags/Vuex/">Vuex</a></li><li class="tag-item"><a class="tag-link" href="/tags/charles/">charles</a></li><li class="tag-item"><a class="tag-link" href="/tags/css/">css</a></li><li class="tag-item"><a class="tag-link" href="/tags/cssmodules/">cssmodules</a></li><li class="tag-item"><a class="tag-link" href="/tags/fetch/">fetch</a></li><li class="tag-item"><a class="tag-link" href="/tags/flutter/">flutter</a></li><li class="tag-item"><a class="tag-link" href="/tags/formData/">formData</a></li><li class="tag-item"><a class="tag-link" href="/tags/git/">git</a></li><li class="tag-item"><a class="tag-link" href="/tags/html/">html</a></li><li class="tag-item"><a class="tag-link" href="/tags/indexDB/">indexDB</a></li><li class="tag-item"><a class="tag-link" href="/tags/io-js/">io.js</a></li><li class="tag-item"><a class="tag-link" href="/tags/jsCode/">jsCode</a></li><li class="tag-item"><a class="tag-link" href="/tags/linux/">linux</a></li><li class="tag-item"><a class="tag-link" href="/tags/meta/">meta</a></li><li class="tag-item"><a class="tag-link" href="/tags/mongoDB/">mongoDB</a></li><li class="tag-item"><a class="tag-link" href="/tags/node-js/">node.js</a></li><li class="tag-item"><a class="tag-link" href="/tags/nodeJS/">nodeJS</a></li><li class="tag-item"><a class="tag-link" href="/tags/pm2/">pm2</a></li><li class="tag-item"><a class="tag-link" href="/tags/shelljs/">shelljs</a></li><li class="tag-item"><a class="tag-link" href="/tags/sort/">sort</a></li><li class="tag-item"><a class="tag-link" href="/tags/typescript/">typescript</a></li><li class="tag-item"><a class="tag-link" href="/tags/vue/">vue</a></li><li class="tag-item"><a class="tag-link" href="/tags/webScoket/">webScoket</a></li><li class="tag-item"><a class="tag-link" href="/tags/名词解释/">名词解释</a></li><li class="tag-item"><a class="tag-link" href="/tags/小程序/">小程序</a></li><li class="tag-item"><a class="tag-link" href="/tags/布局/">布局</a></li><li class="tag-item"><a class="tag-link" href="/tags/测试/">测试</a></li><li class="tag-item"><a class="tag-link" href="/tags/茶余饭后/">茶余饭后</a></li><li class="tag-item"><a class="tag-link" href="/tags/跨域/">跨域</a></li></ul></div></aside></main><footer class="page__footer"><section class="footer__top"><div class="page__container footer__container"><div class="footer-top__item footer-top__item--2"><h3 class="item__title">关于</h3><div class="item__content"><p class="item__text">本站是基于 Hexo 搭建的静态资源博客，主要用于分享日常学习、生活及工作的一些心得总结。</p><ul class="footer__contact-info"><li class="contact-info__item"><i class="iconfont icon-address"></i> <span>BeiJing, China</span></li><li class="contact-info__item"><i class="iconfont icon-email2"></i> <span>18600917746@163.com</span></li></ul></div></div><div class="footer-top__item footer__image"><img src="/images/pay.jpg" alt="logo" title="cheng"></div><div class="footer-top__item"><h3 class="item__title">友情链接</h3><div class="item__content"><ul class="footer-top__list"><li class="list-item"><a href="https://github.com/Mrminfive/hexo-theme-skapp" title="hexo-theme-skapp" target="_blank">hexo-theme-skapp</a></li></ul></div></div><div class="footer-top__item"><h3 class="item__title">构建工具</h3><div class="item__content"><ul class="footer-top__list"><li class="list-item"><a href="https://hexo.io/" title="Blog Framework" target="_blank">Hexo</a></li></ul></div></div></div></section><section class="footer__bottom"><div class="page__container footer__container"><p class="footer__copyright">© <a href="https://github.com/Mrminfive/hexo-theme-skapp" target="_blank">Skapp</a> 2017 powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, made by <a href="https://github.com/Mrminfive" target="_blank">minfive</a>.</p><ul class="footer__social-network clearfix"><li class="social-network__item"><a href="https://github.com/18600917746" target="_blank" title="github"><i class="iconfont icon-github"></i></a></li><li class="social-network__item"><a href="mailto:18600917746@163.com" target="_blank" title="email"><i class="iconfont icon-email"></i></a></li><li class="social-network__item"><a href="/atom.xml" target="_blank" title="rss"><i class="iconfont icon-rss"></i></a></li></ul></div></section></footer><div id="back-top" class="back-top back-top--hidden js-hidden"><i class="iconfont icon-top"></i></div></div><script src="/js/common.js"></script><script src="/js/page/post.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></body></html>
<!DOCTYPE html><html lang="zh-cn"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><title>hello-mongoDB | 腹有诗书气自华</title><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="author" content="[object Object]"><meta name="designer" content="minfive"><meta name="keywords" content="前端博客, 前端, 程序员, 前端开发, vue, node.js, javascript"><meta name="description" content="日常学习与兴趣交流的个人博客"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=yes"><meta name="mobile-web-app-capable" content="yes"><meta name="robots" content="all"><link rel="canonical" href="https://18600917746.github.io/2019/01/28/hello-mongoDB/index.html"><link rel="icon" type="image/png" href="/images/favicon.ico" sizes="32x32"><link rel="stylesheet" href="/scss/base/index.css"><link rel="alternate" href="/atom.xml" title="cheng"><link rel="stylesheet" href="/scss/views/page/post.css"></head><body ontouchstart=""><div id="page-loading" class="page page-loading" style="background-image:url(/images/loader.gif)"></div><div id="page" class="page js-hidden"><header class="page__small-header page__header--small"><nav class="page__navbar"><div class="page__container navbar-container"><a class="page__logo" href="/" title="cheng" alt="cheng"><img src="/images/images.jpeg" alt="cheng"></a><nav class="page__nav"><ul class="nav__list clearfix"><li class="nav__item"><a href="/" alt="首页" title="首页">首页</a></li><li class="nav__item"><a href="/archives" alt="归档" title="归档">归档</a></li><li class="nav__item"><a href="/about" alt="关于" title="关于">关于</a></li></ul></nav><button class="page__menu-btn" type="button"><i class="iconfont icon-menu"></i></button></div></nav></header><main class="page__container page__main"><div class="page__content"><article class="page__post"><div class="post__cover"><img src="/images/default-bg.jpg" alt="hello-mongoDB"></div><header class="post__info"><h1 class="post__title">hello-mongoDB</h1><div class="post__mark"><div class="mark__block"><i class="mark__icon iconfont icon-write"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="/">cheng</a></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-time"></i><ul class="mark__list clearfix"><li class="mark__item"><span>2019-01-28</span></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-tab"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="/tags/mongoDB/">mongoDB</a></li></ul></div></div></header><div class="post__content"><h2 id="MongoDB的启动方式"><a href="#MongoDB的启动方式" class="headerlink" title="MongoDB的启动方式"></a>MongoDB的启动方式</h2><blockquote><p>1.通过命令启动mongo服务<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongod --dbpath = D:\mongodb\data\db --logpath = D:\mongodb\data\<span class="built_in">log</span>\mongod.log</span><br></pre></td></tr></table></figure><p></p></blockquote><blockquote><p>2.通过配置文件来启动mongo服务，配置文件需要自己创建，只需要在-f 后制定你自己的配置文件路径即可<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongod -f D:\mongodb\conf\mongo.conf</span><br></pre></td></tr></table></figure><p></p></blockquote><h4 id="mongo-conf"><a href="#mongo-conf" class="headerlink" title="mongo.conf"></a>mongo.conf</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">systemLog:</span><br><span class="line">   	destination: file</span><br><span class="line">	path: C:\Users\Administrator\Desktop\nnn\dataBase\data\log\mongod.log</span><br><span class="line">storage:</span><br><span class="line">   	dbPath: C:\Users\Administrator\Desktop\nnn\dataBase\data\db</span><br><span class="line">net:</span><br><span class="line">	bindIp: 127.0.0.1</span><br><span class="line">  		port: 27018</span><br></pre></td></tr></table></figure><h2 id="MongoDB-Shell"><a href="#MongoDB-Shell" class="headerlink" title="MongoDB Shell"></a>MongoDB Shell</h2><blockquote><p>连接已开启的 mongoDB 服务器<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongo --port=27018</span><br></pre></td></tr></table></figure><p></p></blockquote><blockquote><p>重启 mongoDB 服务器<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongo restart</span><br></pre></td></tr></table></figure><p></p></blockquote><blockquote><p>创建数据库 of 切换数据库<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use one</span><br></pre></td></tr></table></figure><p></p></blockquote><blockquote><p>显示已有数据库（不包括 无表 数据库）<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show dbs</span><br></pre></td></tr></table></figure><p></p></blockquote><blockquote><p>查看当前所在的数据库<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db</span><br></pre></td></tr></table></figure><p></p></blockquote><blockquote><p>查看当前所在的表<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.show collections</span><br><span class="line">2.show tables</span><br></pre></td></tr></table></figure><p></p></blockquote><blockquote><p>查看数据库版本<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.version()</span><br></pre></td></tr></table></figure><p></p></blockquote><blockquote><p>查看当前用户信息<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show users</span><br></pre></td></tr></table></figure><p></p></blockquote><blockquote><p>在当前数据库下创建表<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.table.inset(&#123;&#125;);</span><br></pre></td></tr></table></figure><p></p></blockquote><blockquote><p>退出当前 shell<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.exit</span><br><span class="line">2.Ctrl + c</span><br></pre></td></tr></table></figure><p></p></blockquote><h2 id="数据库开启权限"><a href="#数据库开启权限" class="headerlink" title="数据库开启权限"></a>数据库开启权限</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">systemLog:</span><br><span class="line">   	destination: file</span><br><span class="line">	path: C:\Users\Administrator\Desktop\nnn\dataBase\data\log\mongod.log</span><br><span class="line">storage:</span><br><span class="line">   	dbPath: C:\Users\Administrator\Desktop\nnn\dataBase\data\db</span><br><span class="line">net:</span><br><span class="line">	bindIp: 127.0.0.1</span><br><span class="line">  		port: 27018</span><br><span class="line">   security:</span><br><span class="line">     authorization: enabled//启用授权</span><br></pre></td></tr></table></figure><h2 id="MongoDB基本的角色"><a href="#MongoDB基本的角色" class="headerlink" title="MongoDB基本的角色"></a>MongoDB基本的角色</h2><ul><li>1.数据库用户角色：read、readWrite;</li><li>2.数据库管理角色：dbAdmin、dbOwner、userAdmin；</li><li>3.集群管理角色：clusterAdmin、clusterManager、clusterMonitor、hostManager；</li><li>4.备份恢复角色：backup、restore；</li><li>5.所有数据库角色：readAnyDatabase、readWriteAnyDatabase、userAdminAnyDatabase、dbAdminAnyDatabase</li><li>6.超级用户角色：root<h3 id="创建root-admin用户"><a href="#创建root-admin用户" class="headerlink" title="创建root/admin用户"></a>创建root/admin用户</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">use admin</span><br><span class="line">db.createUser(&#123;user:<span class="string">"root"</span>,<span class="built_in">pwd</span>:<span class="string">"password"</span>,roles:[<span class="string">"root"</span>]&#125;)</span><br><span class="line"></span><br><span class="line">db.createUser(  </span><br><span class="line">  &#123;  </span><br><span class="line">    user: <span class="string">"admin"</span>,  </span><br><span class="line">    <span class="built_in">pwd</span>: <span class="string">"password"</span>,  </span><br><span class="line">    roles: [&#123;role: <span class="string">"userAdminAnyDatabase"</span>, db: <span class="string">"admin"</span>&#125;]  </span><br><span class="line">  &#125;  </span><br><span class="line">)</span><br></pre></td></tr></table></figure></li></ul><h3 id="修改用户密码"><a href="#修改用户密码" class="headerlink" title="修改用户密码"></a>修改用户密码</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.updateUser( <span class="string">"admin"</span>,&#123;<span class="built_in">pwd</span>:<span class="string">"password"</span>&#125;);</span><br></pre></td></tr></table></figure><h3 id="密码认证"><a href="#密码认证" class="headerlink" title="密码认证"></a>密码认证</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.auth(<span class="string">"admin"</span>,<span class="string">"password"</span>);</span><br></pre></td></tr></table></figure><h3 id="删除用户"><a href="#删除用户" class="headerlink" title="删除用户"></a>删除用户</h3><blockquote><p>删除用户(需要root权限，会将所有数据库中的football用户删除)<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.system.users.remove(&#123;user:<span class="string">"football"</span>&#125;);</span><br></pre></td></tr></table></figure><p></p></blockquote><blockquote><p>删除用户(权限要求没有那么高，只删除本数据中的football用户)<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.dropUser(<span class="string">"football"</span>);</span><br></pre></td></tr></table></figure><p></p></blockquote><h2 id="数据库-基本操作"><a href="#数据库-基本操作" class="headerlink" title="数据库 基本操作"></a>数据库 基本操作</h2><h3 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h3><h4 id="1-inset-data-单条插入数据库，并创建-id"><a href="#1-inset-data-单条插入数据库，并创建-id" class="headerlink" title="1.inset(data) 单条插入数据库，并创建 _id"></a>1.inset(data) 单条插入数据库，并创建 _id</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> data=&#123;</span><br><span class="line">	<span class="string">"name"</span>:<span class="string">'lishi'</span>,</span><br><span class="line">	<span class="string">"age"</span>:<span class="number">24</span></span><br><span class="line"> 	&#125;</span><br><span class="line">db.table.insert(data);</span><br></pre></td></tr></table></figure><h4 id="2-batchInset-data-多条插入数据库，并创建-id-适用于多条数据插入到一个表中"><a href="#2-batchInset-data-多条插入数据库，并创建-id-适用于多条数据插入到一个表中" class="headerlink" title="2.batchInset(data) 多条插入数据库，并创建 _id [适用于多条数据插入到一个表中]"></a>2.batchInset(data) 多条插入数据库，并创建 _id [适用于多条数据插入到一个表中]</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> data=[&#123;</span><br><span class="line">	<span class="string">"name"</span>:<span class="string">'lishi'</span>,</span><br><span class="line">	<span class="string">"age"</span>:<span class="number">24</span></span><br><span class="line"> 	&#125;,&#123;</span><br><span class="line">	<span class="string">"name"</span>:<span class="string">'zhaoliu'</span>,</span><br><span class="line">	<span class="string">"age"</span>:<span class="number">22</span></span><br><span class="line"> 	&#125;]</span><br><span class="line">db.table.batchInset(data);</span><br></pre></td></tr></table></figure><h4 id="第三方数据库导入"><a href="#第三方数据库导入" class="headerlink" title="第三方数据库导入"></a>第三方数据库导入</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">使用 mongoimport  最大消息长度是 48M ，插入错误立即停止</span><br></pre></td></tr></table></figure><h4 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">所有 文档 都要在 16M 以下</span><br></pre></td></tr></table></figure><h3 id="查询数据库"><a href="#查询数据库" class="headerlink" title="查询数据库"></a>查询数据库</h3><h4 id="1-find-option"><a href="#1-find-option" class="headerlink" title="1.find(option);"></a>1.find(option);</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.table.find(&#123;&#125;);</span><br></pre></td></tr></table></figure><h4 id="2-findOne-option"><a href="#2-findOne-option" class="headerlink" title="2.findOne(option);"></a>2.findOne(option);</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.table.findOne();</span><br></pre></td></tr></table></figure><h3 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h3><h4 id="1-update-option-data-upsert-More"><a href="#1-update-option-data-upsert-More" class="headerlink" title="1.update(option,data,upsert,More);"></a>1.update(option,data,upsert,More);</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> data=&#123;</span><br><span class="line">	<span class="string">"name"</span>:<span class="string">'lishi -&gt; zhangsan'</span>,</span><br><span class="line">	<span class="string">"age"</span>:<span class="number">25</span></span><br><span class="line"> 	&#125;</span><br><span class="line">db.table.update(&#123;<span class="string">"name"</span>:<span class="string">'lishi'</span>&#125;,data);</span><br></pre></td></tr></table></figure><table><thead><tr><th>参数</th><th>类型</th><th>默认值</th><th>是否必填</th><th>描述</th></tr></thead><tbody><tr><td>option</td><td>object</td><td>{}</td><td>y</td><td>查询条件</td></tr><tr><td>data</td><td>object</td><td>{}</td><td>y</td><td>插入的数据</td></tr><tr><td>upsert</td><td>boolean</td><td>false</td><td>n{建议默认填写}</td><td>是否使用upsert</td></tr><tr><td>More</td><td>boolean</td><td>false</td><td>n{建议默认填写}</td><td>是否更新多个文档</td></tr></tbody></table><h3 id="【永久删除】数据"><a href="#【永久删除】数据" class="headerlink" title="【永久删除】数据"></a>【永久删除】数据</h3><h4 id="1-remove-option"><a href="#1-remove-option" class="headerlink" title="1.remove(option);"></a>1.remove(option);</h4><blockquote><p>option 为空时删除所有的数据<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> data=&#123;</span><br><span class="line">	<span class="string">"name"</span>:<span class="string">'lishi -&gt; zhangsan'</span></span><br><span class="line"> 	&#125;</span><br><span class="line">db.table.remove(data);</span><br></pre></td></tr></table></figure><p></p></blockquote><h3 id="【永久删除】清空表"><a href="#【永久删除】清空表" class="headerlink" title="【永久删除】清空表"></a>【永久删除】清空表</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.table.drop()</span><br></pre></td></tr></table></figure><h2 id="创建-mongorc-js-文件-mongo-同级目录自动执行文件-常用于移除危险操作"><a href="#创建-mongorc-js-文件-mongo-同级目录自动执行文件-常用于移除危险操作" class="headerlink" title="创建 .mongorc.js 文件    [mongo 同级目录自动执行文件]{常用于移除危险操作}"></a>创建 .mongorc.js 文件 [mongo 同级目录自动执行文件]{常用于移除危险操作}</h2><blockquote><p>启动时 –norc 可以禁止启动 .mongorc.js 文件<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .mongorc.js</span></span><br><span class="line"><span class="keyword">var</span> list = [<span class="string">'one'</span>,<span class="string">'two'</span>,<span class="string">'three'</span>];</span><br><span class="line"><span class="keyword">var</span> index = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random()*<span class="number">3</span>);</span><br><span class="line">print(<span class="string">'Hell，'</span>+list[index]+<span class="string">'haha'</span>);</span><br><span class="line"><span class="comment">// 常用于移除危险操作</span></span><br><span class="line"><span class="keyword">var</span> no=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	print(<span class="string">'Not on my watch.'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 禁止删除数据库</span></span><br><span class="line">db.dropDatabase = DB.prototype.dropDatabase = no;</span><br><span class="line"><span class="comment">// 禁止删除集合</span></span><br><span class="line">DBCollection.prototype.drop = no;</span><br><span class="line"><span class="comment">// 禁止删除索引</span></span><br><span class="line">DBCollection.prototype.dropIndex = no；</span><br></pre></td></tr></table></figure><p></p></blockquote><h2 id="update-使用修改器"><a href="#update-使用修改器" class="headerlink" title="update 使用修改器"></a>update 使用修改器</h2><h3 id="set-修改单条数据"><a href="#set-修改单条数据" class="headerlink" title="$set 修改单条数据"></a>$set 修改单条数据</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.table.findOne();</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5bd52f7700530261250525b6"</span>), <span class="string">"name"</span> : <span class="string">"cheng"</span> &#125;</span><br><span class="line">db.table.update(&#123;<span class="string">"_id"</span> : ObjectId(<span class="string">"5bd52f7700530261250525b6"</span>)&#125;,&#123;<span class="string">"$set"</span>:&#123;<span class="string">"name"</span>:<span class="string">'lishi'</span>&#125;&#125;);</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5bd52f7700530261250525b6"</span>), <span class="string">"name"</span> : <span class="string">"lishi"</span> &#125;</span><br></pre></td></tr></table></figure><h3 id="unset-删除单条数据"><a href="#unset-删除单条数据" class="headerlink" title="$unset 删除单条数据"></a>$unset 删除单条数据</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.table.findOne();</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5bd52f7700530261250525b6"</span>), <span class="string">"name"</span> : <span class="string">"lishi"</span> &#125;</span><br><span class="line">db.table.update(&#123;<span class="string">"_id"</span> : ObjectId(<span class="string">"5bd52f7700530261250525b6"</span>)&#125;,&#123;<span class="string">"$unset"</span>:&#123;<span class="string">"name"</span>:<span class="number">1</span>&#125;&#125;);</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5bd52f7700530261250525b6"</span>)&#125;</span><br></pre></td></tr></table></figure><h3 id="inc-数字类-值增加或减少"><a href="#inc-数字类-值增加或减少" class="headerlink" title="$inc 数字类 值增加或减少"></a>$inc 数字类 值增加或减少</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">db.table.findOne();</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5bd52f7700530261250525b6"</span>), <span class="string">"name"</span> : <span class="string">"lishi"</span> &#125;</span><br><span class="line">db.table.update(&#123;<span class="string">"_id"</span> : ObjectId(<span class="string">"5bd52f7700530261250525b6"</span>)&#125;,&#123;<span class="string">"$inc"</span>:&#123;<span class="string">"score"</span>:<span class="number">10</span>&#125;&#125;);</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5bd52f7700530261250525b6"</span>),&#123;<span class="string">"score"</span>:<span class="number">10</span>&#125;&#125;</span><br><span class="line">db.table.update(&#123;<span class="string">"_id"</span> : ObjectId(<span class="string">"5bd52f7700530261250525b6"</span>)&#125;,&#123;<span class="string">"$inc"</span>:&#123;<span class="string">"score"</span>:<span class="number">-2</span>&#125;&#125;);</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5bd52f7700530261250525b6"</span>),&#123;<span class="string">"score"</span>:<span class="number">8</span>&#125;&#125;</span><br></pre></td></tr></table></figure><h3 id="push-数组修改器"><a href="#push-数组修改器" class="headerlink" title="$push [数组修改器]"></a>$push [数组修改器]</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">db.table.findOne();</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5bd52f7700530261250525b6"</span>),&#123;<span class="string">"score"</span>:<span class="number">8</span>&#125;&#125;</span><br><span class="line">db.table.update(&#123;<span class="string">"_id"</span>:ObjectId(<span class="string">"5bd52f7700530261250525b6"</span>)&#125;,&#123;<span class="string">"$push"</span>:&#123;<span class="string">"comments"</span>:&#123;<span class="string">"name"</span>:<span class="string">"joe"</span>,<span class="string">"age"</span>:<span class="number">24</span>,<span class="string">"content"</span>:<span class="string">"Hello..."</span>&#125;&#125;&#125;);</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5bd55e45e299a187e4ed729f"</span>), <span class="string">"age"</span> : <span class="number">190</span>, <span class="string">"comments"</span> : [ &#123; <span class="string">"name"</span> : <span class="string">"joe"</span>, <span class="string">"age"</span> : <span class="number">24</span>, <span class="string">"content"</span> : <span class="string">"Hello..."</span> &#125; ] &#125;</span><br><span class="line"><span class="comment">// 一次 $push 添加多次数值</span></span><br><span class="line">db.table.update(&#123;<span class="string">"_id"</span>:ObjectId(<span class="string">"5bd52f7700530261250525b6"</span>)&#125;,&#123;<span class="string">"$push"</span>:&#123;<span class="string">"comments"</span>:&#123;<span class="string">"$each"</span>:[<span class="number">10</span>,<span class="number">20</span>,<span class="number">30</span>,<span class="number">40</span>]&#125;&#125;&#125;);</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5bd55e45e299a187e4ed729f"</span>), <span class="string">"age"</span> : <span class="number">190</span>, <span class="string">"comments"</span> : [ &#123; <span class="string">"name"</span> : <span class="string">"joe"</span>, <span class="string">"age"</span> : <span class="number">24</span>, <span class="string">"content"</span> : <span class="string">"Hello..."</span> &#125;,<span class="number">10</span>,<span class="number">20</span>,<span class="number">30</span>,<span class="number">40</span> ] &#125;</span><br></pre></td></tr></table></figure><h3 id="slice-限制数组的长度-参数只能是负数"><a href="#slice-限制数组的长度-参数只能是负数" class="headerlink" title="$slice 限制数组的长度 [参数只能是负数]"></a>$slice 限制数组的长度 [参数只能是负数]</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 保留最后添加的 10 个</span></span><br><span class="line">db.table.update(&#123;<span class="string">"_id"</span>:ObjectId(<span class="string">"5bd52f7700530261250525b6"</span>)&#125;,&#123;</span><br><span class="line"><span class="string">"$push"</span>:&#123;<span class="string">"comments"</span>:&#123;</span><br><span class="line">	<span class="string">"$each"</span>:[<span class="number">10</span>,<span class="number">20</span>,<span class="number">30</span>,<span class="number">40</span>],</span><br><span class="line">	<span class="string">"$slice"</span>:<span class="number">-10</span></span><br><span class="line">&#125;&#125;&#125;);</span><br><span class="line"><span class="comment">// 保留前 10 个 根据 name 进行排序 保留</span></span><br><span class="line">db.table.update(&#123;<span class="string">"_id"</span>:ObjectId(<span class="string">"5bd52f7700530261250525b6"</span>)&#125;,&#123;</span><br><span class="line"><span class="string">"$push"</span>:&#123;<span class="string">"comments"</span>:&#123;</span><br><span class="line">	<span class="string">"$each"</span>:[<span class="number">10</span>,<span class="number">20</span>,<span class="number">30</span>,<span class="number">40</span>],</span><br><span class="line">	<span class="string">"$slice"</span>:<span class="number">-10</span>,</span><br><span class="line">	<span class="string">"$sort"</span>:&#123;<span class="string">"name"</span>:<span class="number">-1</span>&#125;</span><br><span class="line">&#125;&#125;&#125;);</span><br></pre></td></tr></table></figure><h3 id="addToSet-数组去重复添加"><a href="#addToSet-数组去重复添加" class="headerlink" title="$addToSet 数组去重复添加"></a>$addToSet 数组去重复添加</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">db.table.findOne()；</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5bd56a7ae299a187e4ed72a0"</span>), <span class="string">"list"</span> : [ <span class="string">"张三"</span>, <span class="string">"李四"</span> ] &#125;</span><br><span class="line">da.table.update(&#123;<span class="string">"_id"</span> : ObjectId(<span class="string">"5bd56a7ae299a187e4ed72a0"</span>)&#125;,&#123;<span class="string">"$addToSet"</span>:&#123;<span class="string">"list"</span>:<span class="string">"王五"</span>&#125;&#125;)；</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5bd56a7ae299a187e4ed72a0"</span>), <span class="string">"list"</span> : [ <span class="string">"张三"</span>, <span class="string">"李四"</span>,<span class="string">"王五"</span> ] &#125;</span><br><span class="line">da.table.update(&#123;<span class="string">"_id"</span> : ObjectId(<span class="string">"5bd56a7ae299a187e4ed72a0"</span>)&#125;,&#123;<span class="string">"$addToSet"</span>:&#123;<span class="string">"list"</span>:<span class="string">"王五"</span>&#125;&#125;)；</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5bd56a7ae299a187e4ed72a0"</span>), <span class="string">"list"</span> : [ <span class="string">"张三"</span>, <span class="string">"李四"</span>,<span class="string">"王五"</span> ] &#125;</span><br></pre></td></tr></table></figure><h3 id="each-循环添加-去重"><a href="#each-循环添加-去重" class="headerlink" title="$each 循环添加 + 去重"></a>$each 循环添加 + 去重</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.table.findOne()；</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5bd56a7ae299a187e4ed72a0"</span>), <span class="string">"list"</span> : [ <span class="string">"张三"</span>, <span class="string">"李四"</span>,<span class="string">"王五"</span> ] &#125;</span><br><span class="line">db.table.update(&#123;<span class="string">"_id"</span> : ObjectId(<span class="string">"5bd56a7ae299a187e4ed72a0"</span>)&#125;,&#123;<span class="string">"$addToSet"</span>:&#123;<span class="string">"list"</span>:&#123;<span class="string">"$each"</span>:[<span class="string">"钱七"</span>,<span class="string">"李八"</span>,<span class="string">"王五"</span>]&#125;&#125;&#125;)</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5bd56a7ae299a187e4ed72a0"</span>), <span class="string">"list"</span> : [ <span class="string">"张三"</span>, <span class="string">"李四"</span>, <span class="string">"王五"</span>, <span class="string">"钱七"</span>, <span class="string">"李八"</span> ] &#125;</span><br></pre></td></tr></table></figure><h3 id="pop-数组删除元素-1-删除最后一个-1-删除第一个"><a href="#pop-数组删除元素-1-删除最后一个-1-删除第一个" class="headerlink" title="$pop 数组删除元素 [ 1 删除最后一个 -1 删除第一个]"></a>$pop 数组删除元素 [ 1 删除最后一个 -1 删除第一个]</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">db.table.findOne()；</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5bd56a7ae299a187e4ed72a0"</span>), <span class="string">"list"</span> : [ <span class="string">"张三"</span>, <span class="string">"李四"</span>, <span class="string">"王五"</span>, <span class="string">"钱七"</span>, <span class="string">"李八"</span> ] &#125;</span><br><span class="line">db.table.update(&#123;<span class="string">"_id"</span> : ObjectId(<span class="string">"5bd56a7ae299a187e4ed72a0"</span>)&#125;,&#123;<span class="string">"$pop"</span>:&#123;<span class="string">"list"</span>:<span class="number">1</span>&#125;&#125;)</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5bd56a7ae299a187e4ed72a0"</span>), <span class="string">"list"</span> : [ <span class="string">"张三"</span>, <span class="string">"李四"</span>, <span class="string">"王五"</span>, <span class="string">"钱七"</span>] &#125;</span><br><span class="line">db.table.update(&#123;<span class="string">"_id"</span> : ObjectId(<span class="string">"5bd56a7ae299a187e4ed72a0"</span>)&#125;,&#123;<span class="string">"$pop"</span>:&#123;<span class="string">"list"</span>:<span class="number">-1</span>&#125;&#125;)</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5bd56a7ae299a187e4ed72a0"</span>), <span class="string">"list"</span> : [<span class="string">"李四"</span>, <span class="string">"王五"</span>, <span class="string">"钱七"</span>] &#125;</span><br></pre></td></tr></table></figure><h3 id="pull-数组指定删除元素-会删除数组中所有的匹配值"><a href="#pull-数组指定删除元素-会删除数组中所有的匹配值" class="headerlink" title="$pull 数组指定删除元素 [会删除数组中所有的匹配值]"></a>$pull 数组指定删除元素 [会删除数组中所有的匹配值]</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.table.findOne()；</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5bd56a7ae299a187e4ed72a0"</span>), <span class="string">"list"</span> : [<span class="string">"李四"</span>, <span class="string">"王五"</span>, <span class="string">"钱七"</span>] &#125;</span><br><span class="line">db.table.update(&#123;<span class="string">"_id"</span> : ObjectId(<span class="string">"5bd56a7ae299a187e4ed72a0"</span>)&#125;,&#123;<span class="string">"$pull"</span>:&#123;<span class="string">"list"</span>:<span class="string">"钱七"</span>&#125;&#125;)</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5bd56a7ae299a187e4ed72a0"</span>), <span class="string">"list"</span> : [<span class="string">"李四"</span>, <span class="string">"王五"</span>] &#125;</span><br></pre></td></tr></table></figure><h3 id="定位符修改数据"><a href="#定位符修改数据" class="headerlink" title="$ 定位符修改数据"></a>$ 定位符修改数据</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.table.findOne()；</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5bd56a7ae299a187e4ed72a0"</span>), <span class="string">"list"</span> : [ &#123; <span class="string">"name"</span> : <span class="string">"cheng"</span>, <span class="string">"age"</span> : <span class="number">12</span> &#125;, &#123; <span class="string">"name"</span> : <span class="string">"li"</span>, <span class="string">"age"</span> : <span class="number">24</span> &#125;] &#125;</span><br><span class="line">db.table.update(&#123;<span class="string">"list.name"</span>:<span class="string">"cheng"</span>&#125;,&#123;<span class="string">"$set"</span>:&#123;<span class="string">"list.$.name"</span>:<span class="string">"钱七"</span>&#125;&#125;)</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5bd56a7ae299a187e4ed72a0"</span>), <span class="string">"list"</span> : [ &#123; <span class="string">"name"</span> : <span class="string">"钱七"</span>, <span class="string">"age"</span> : <span class="number">12</span> &#125;, &#123; <span class="string">"name"</span> : <span class="string">"li"</span>, <span class="string">"age"</span> : <span class="number">24</span> &#125;] &#125;</span><br></pre></td></tr></table></figure><h3 id="setOnInsert-创建同时进行赋值，并后期不会通过-setOnInsert-更新"><a href="#setOnInsert-创建同时进行赋值，并后期不会通过-setOnInsert-更新" class="headerlink" title="$setOnInsert 创建同时进行赋值，并后期不会通过 $setOnInsert 更新"></a>$setOnInsert 创建同时进行赋值，并后期不会通过 $setOnInsert 更新</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.one.update(&#123;&#125;,&#123;<span class="string">"$setOneInsert"</span>:&#123;<span class="string">"createdAt"</span>:<span class="keyword">new</span> <span class="built_in">Date</span>()&#125;&#125;,<span class="literal">true</span>)</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5bd716bbbae1b855f37013b2"</span>), <span class="string">"createAt"</span> : ISODate(<span class="string">"2018-10-29T14:20:02.287Z"</span>) &#125;</span><br><span class="line">db.one.update(&#123;&#125;,&#123;<span class="string">"$setOneInsert"</span>:&#123;<span class="string">"createdAt"</span>:<span class="keyword">new</span> <span class="built_in">Date</span>()&#125;&#125;,<span class="literal">true</span>)</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5bd716bbbae1b855f37013b2"</span>), <span class="string">"createAt"</span> : ISODate(<span class="string">"2018-10-29T14:20:02.287Z"</span>) &#125;</span><br></pre></td></tr></table></figure><h2 id="save-shell-帮助函数-实现快速的修改"><a href="#save-shell-帮助函数-实现快速的修改" class="headerlink" title="save() shell 帮助函数 实现快速的修改"></a>save() shell 帮助函数 实现快速的修改</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x =db.one.findOne();</span><br><span class="line">x.num =<span class="number">24</span>;</span><br><span class="line">db.one.save(x);</span><br></pre></td></tr></table></figure><h2 id="db-runCommand-getLastError-n-返回最后-n-次的相关信息"><a href="#db-runCommand-getLastError-n-返回最后-n-次的相关信息" class="headerlink" title="db.runCommand({getLastError: n }) 返回最后 n 次的相关信息"></a>db.runCommand({getLastError: n }) 返回最后 n 次的相关信息</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="string">"connectionId"</span> : <span class="number">5</span>,</span><br><span class="line">       <span class="string">"updatedExisting"</span> : <span class="literal">true</span>,</span><br><span class="line">       <span class="string">"n"</span> : <span class="number">1</span>,</span><br><span class="line">       <span class="string">"syncMillis"</span> : <span class="number">0</span>,</span><br><span class="line">       <span class="string">"writtenTo"</span> : <span class="literal">null</span>,</span><br><span class="line">       <span class="string">"err"</span> : <span class="literal">null</span>,</span><br><span class="line">       <span class="string">"ok"</span> : <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>返回参数描述</p></blockquote><table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>connectionId</td><td>匹配并修改</td></tr><tr><td>updatedExisting</td><td>是否更新成功</td></tr><tr><td>n</td><td>更新的文档个数</td></tr><tr><td>syncMillis</td><td>修改并插入</td></tr><tr><td>writtenTo</td><td>修改并插入</td></tr><tr><td>err</td><td>修改并插入</td></tr><tr><td>ok</td><td>成功的个数</td></tr><tr><td>codeName</td><td>代码名称</td></tr><tr><td>errmsg</td><td>错误描述</td></tr></tbody></table><h2 id="db-runCommand-“findAndModify”-”process”-返回被更新的文档"><a href="#db-runCommand-“findAndModify”-”process”-返回被更新的文档" class="headerlink" title="db.runCommand({“findAndModify”:”process”})返回被更新的文档"></a>db.runCommand({“findAndModify”:”process”})返回被更新的文档</h2><h1 id="数据库查询"><a href="#数据库查询" class="headerlink" title="数据库查询"></a>数据库查询</h1><h2 id="find"><a href="#find" class="headerlink" title="find()"></a>find()</h2><h3 id="find-key1-val1-key2-val2-多条件精准查询"><a href="#find-key1-val1-key2-val2-多条件精准查询" class="headerlink" title="find({key1:val1,key2:val2}) 多条件精准查询"></a>find({key1:val1,key2:val2}) 多条件精准查询</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询所有 name 是 lisi 并且 age 是 24 的数据</span></span><br><span class="line">db.one.find(&#123;<span class="string">"name"</span>:<span class="string">"lisi"</span>,<span class="string">"age"</span>:<span class="number">24</span>&#125;);</span><br></pre></td></tr></table></figure><h3 id="find-option-返回-指定-键值对"><a href="#find-option-返回-指定-键值对" class="headerlink" title="find({},option) 返回 指定 键值对"></a>find({},option) 返回 指定 键值对</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回所有数据，并显示指定的 键/值  1 是显示 ， 0 是剔除</span></span><br><span class="line">find(&#123;&#125;,&#123;<span class="string">"name"</span>:<span class="number">1</span>&#125;)</span><br><span class="line">&#123;<span class="string">"_id"</span> : ObjectId(<span class="string">"5bd716bbbae1b855f37013b2"</span>),<span class="string">"name"</span> : <span class="string">"cheng"</span> &#125;</span><br><span class="line">find(&#123;&#125;,&#123;<span class="string">"name"</span>:<span class="number">1</span>,<span class="string">"_id"</span>:<span class="number">0</span>&#125;)</span><br><span class="line">&#123;<span class="string">"name"</span> : <span class="string">"cheng"</span> &#125;</span><br></pre></td></tr></table></figure><h2 id="find-使用查询条件"><a href="#find-使用查询条件" class="headerlink" title="find 使用查询条件"></a>find 使用查询条件</h2><h3 id="lt-lte-gt-gte-ne-对应-lt-lt-gt-gt"><a href="#lt-lte-gt-gte-ne-对应-lt-lt-gt-gt" class="headerlink" title="\$lt  \$lte  \$gt  \$gte  \$ne 对应 &lt;=  &lt;  &gt;  &gt;=  !="></a>\$lt \$lte \$gt \$gte \$ne 对应 &lt;= &lt; &gt; &gt;= !=</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查询 age 小于 24 的</span></span><br><span class="line">db.one.find(&#123;<span class="string">"age"</span>:&#123;<span class="string">"$lt"</span>:<span class="number">24</span>&#125;&#125;)</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5bd716bbbae1b855f37013b2"</span>), <span class="string">"age"</span> : <span class="number">12</span>, <span class="string">"name"</span> : <span class="string">"cheng"</span>&#125;</span><br><span class="line"><span class="comment">//查询 age 大于等于 10 的</span></span><br><span class="line">db.one.find(&#123;<span class="string">"age"</span>:&#123;<span class="string">"$gte"</span>:<span class="number">10</span>&#125;&#125;)</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5bd716bbbae1b855f37013b2"</span>), <span class="string">"age"</span> : <span class="number">12</span>, <span class="string">"name"</span> : <span class="string">"cheng"</span>&#125;</span><br><span class="line"><span class="comment">//查询 age 不等于 10 的</span></span><br><span class="line">db.one.find(&#123;<span class="string">"age"</span>:&#123;<span class="string">"$ne"</span>:<span class="number">10</span>&#125;&#125;)</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5bd716bbbae1b855f37013b2"</span>), <span class="string">"age"</span> : <span class="number">12</span>, <span class="string">"name"</span> : <span class="string">"cheng"</span>&#125;</span><br><span class="line"><span class="comment">//查询 age 大于 12 并小于 24 的数据</span></span><br><span class="line">db.one.fond(&#123;<span class="string">"age"</span>:&#123;<span class="string">"$gt"</span>:<span class="number">12</span>,<span class="string">"$lt"</span>:<span class="number">24</span>&#125;&#125;)</span><br></pre></td></tr></table></figure><h3 id="OR-查询-in-or-not"><a href="#OR-查询-in-or-not" class="headerlink" title="OR 查询 $in $or $not"></a>OR 查询 $in $or $not</h3><blockquote><p>$in 一个键匹配多个值<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询 所有 age 等于 24 或 30 或 190 的数据</span></span><br><span class="line">db.one.find(&#123;<span class="string">"age"</span>:&#123;<span class="string">"$in"</span>:[<span class="number">24</span>,<span class="number">30</span>,<span class="number">190</span>]&#125;&#125;)</span><br></pre></td></tr></table></figure><p></p></blockquote><blockquote><p>$nin 一个键匹配多个值<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询 所有 age 不等于 24 或 30 或 190 的数据</span></span><br><span class="line">db.one.find(&#123;<span class="string">"age"</span>:&#123;<span class="string">"$nin"</span>:[<span class="number">24</span>,<span class="number">30</span>,<span class="number">190</span>]&#125;&#125;)</span><br></pre></td></tr></table></figure><p></p></blockquote><blockquote><p>$or 多 键值对 查询<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查询 name 等于 李四 或者 age 等于 12 的数据</span></span><br><span class="line">db.one.find(&#123;<span class="string">"$or"</span>:[&#123;<span class="string">"name"</span>:<span class="string">"李四"</span>&#125;,&#123;<span class="string">"age"</span>:<span class="number">12</span>&#125;]&#125;)</span><br></pre></td></tr></table></figure><p></p></blockquote><blockquote><p>$not 取反<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查询 age 不等于 5 或者 "190.0 的所有数据</span></span><br><span class="line">db.one.find(&#123;<span class="string">"age"</span>:&#123;<span class="string">"$not"</span>:&#123;<span class="string">"$in"</span>:[<span class="number">5</span>,<span class="string">"190.0"</span>]&#125;&#125;&#125;)</span><br></pre></td></tr></table></figure><p></p></blockquote><h3 id="查询-null"><a href="#查询-null" class="headerlink" title="查询 null"></a>查询 null</h3><blockquote><p>$exists -&gt; 检查 此值是否为 null<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.one.find(&#123;<span class="string">"z"</span>:&#123;<span class="string">"$in"</span>:[<span class="literal">null</span>],<span class="string">"$exists"</span>:<span class="literal">true</span>&#125;&#125;)</span><br></pre></td></tr></table></figure><p></p></blockquote><h2 id="数组查询"><a href="#数组查询" class="headerlink" title="数组查询"></a>数组查询</h2><h3 id="all"><a href="#all" class="headerlink" title="$all"></a>$all</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">db.two.insert(&#123;<span class="string">"list"</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]&#125;)</span><br><span class="line">db.two.insert(&#123;<span class="string">"list"</span>:[<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>]&#125;)</span><br><span class="line">db.two.insert(&#123;<span class="string">"list"</span>:[<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>]&#125;)</span><br><span class="line"><span class="comment">// 查询 list 数包含 2 3 4 </span></span><br><span class="line">db.two.find(&#123;<span class="string">"list"</span>:&#123;<span class="string">"$all"</span>:[<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]&#125;&#125;)</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5bde9a7e0cd06e4da48a9289"</span>), <span class="string">"list"</span> : [ <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span> ] &#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5bde9a880cd06e4da48a928a"</span>), <span class="string">"list"</span> : [ <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> ] &#125;</span><br></pre></td></tr></table></figure><h3 id="size-查询特定长度的-数组"><a href="#size-查询特定长度的-数组" class="headerlink" title="$size 查询特定长度的 数组"></a>$size 查询特定长度的 数组</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//将 "_id" : ObjectId("5bde9a7e0cd06e4da48a9289") 的 list 添加一条</span></span><br><span class="line">db.two.update(&#123;<span class="string">"_id"</span> : ObjectId(<span class="string">"5bde9a7e0cd06e4da48a9289"</span>)&#125;,&#123;<span class="string">"$push"</span>:&#123;<span class="string">"list"</span>:<span class="string">"100"</span>&#125;&#125;)</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5bde9a7e0cd06e4da48a9289"</span>), <span class="string">"list"</span> : [ <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="string">"100"</span> ] &#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5bde9a880cd06e4da48a928a"</span>), <span class="string">"list"</span> : [ <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> ] &#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5bde9a8f0cd06e4da48a928b"</span>), <span class="string">"list"</span> : [ <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span> ] &#125;</span><br><span class="line">db.two.find(&#123;<span class="string">"list"</span>:&#123;<span class="string">"$size"</span>:<span class="number">5</span>&#125;&#125;)</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5bde9a7e0cd06e4da48a9289"</span>), <span class="string">"list"</span> : [ <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="string">"100"</span> ] &#125;</span><br></pre></td></tr></table></figure><h3 id="slice-指定截取-数据"><a href="#slice-指定截取-数据" class="headerlink" title="$slice 指定截取 数据"></a>$slice 指定截取 数据</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//返回 数组前 10 条数据</span></span><br><span class="line">db.two.find(&#123;&#125;,&#123;<span class="string">"list"</span>:&#123;<span class="string">"$slice"</span>:<span class="number">10</span>&#125;&#125;)</span><br><span class="line"><span class="comment">//返回 数组后 10 条数据</span></span><br><span class="line">db.two.find(&#123;&#125;,&#123;<span class="string">"list"</span>:&#123;<span class="string">"$slice"</span>:<span class="number">-10</span>&#125;&#125;)</span><br><span class="line"><span class="comment">// 返回 文档下所有符合匹配条件的数据 的指定条数</span></span><br><span class="line"><span class="comment">// 返回 	</span></span><br><span class="line">db.two.find(&#123;<span class="string">"list.age"</span>:&#123;<span class="string">"$lt"</span>:<span class="number">12</span>&#125;&#125;,&#123;<span class="string">"$slice.$"</span>:<span class="number">2</span>&#125;)</span><br></pre></td></tr></table></figure><h2 id="游标"><a href="#游标" class="headerlink" title="游标"></a>游标</h2><h3 id="limit-限制上限"><a href="#limit-限制上限" class="headerlink" title="limit() 限制上限"></a>limit() 限制上限</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">db.two.find(&#123;&#125;)</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5bde9a7e0cd06e4da48a9289"</span>), <span class="string">"list"</span> : [ <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="string">"100"</span> ] &#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5bde9a880cd06e4da48a928a"</span>), <span class="string">"list"</span> : [ <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> ] &#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5bde9a8f0cd06e4da48a928b"</span>), <span class="string">"list"</span> : [ <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span> ] &#125;</span><br><span class="line">db.two.find(&#123;&#125;).limit(<span class="number">2</span>)</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5bde9a7e0cd06e4da48a9289"</span>), <span class="string">"list"</span> : [ <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="string">"100"</span> ] &#125;</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5bde9a880cd06e4da48a928a"</span>), <span class="string">"list"</span> : [ <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> ] &#125;</span><br></pre></td></tr></table></figure><h3 id="skip-n-跳过-n-个"><a href="#skip-n-跳过-n-个" class="headerlink" title="skip(n) 跳过 n 个"></a>skip(n) 跳过 n 个</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.two.find(&#123;&#125;).skip(<span class="number">2</span>)</span><br><span class="line">&#123; <span class="string">"_id"</span> : ObjectId(<span class="string">"5bde9a8f0cd06e4da48a928b"</span>), <span class="string">"list"</span> : [ <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span> ] &#125;</span><br></pre></td></tr></table></figure><h3 id="sort-排序"><a href="#sort-排序" class="headerlink" title="sort() 排序"></a>sort() 排序</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据 name 升序 age 降序</span></span><br><span class="line">db.two.find().sort(&#123;<span class="string">"name"</span>:<span class="number">1</span>,<span class="string">"age"</span>:<span class="number">-1</span>&#125;)</span><br></pre></td></tr></table></figure><h2 id="数据库命令"><a href="#数据库命令" class="headerlink" title="数据库命令"></a>数据库命令</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 输出所有的 数据库命令</span></span><br><span class="line">db.listCommannds()</span><br></pre></td></tr></table></figure><h2 id="建立索引"><a href="#建立索引" class="headerlink" title="建立索引"></a>建立索引</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据 name 作为 索引值</span></span><br><span class="line">db.two.ensureIndex(&#123;<span class="string">"name"</span>:<span class="number">1</span>&#125;)</span><br></pre></td></tr></table></figure><h2 id="索引类型"><a href="#索引类型" class="headerlink" title="索引类型"></a>索引类型</h2><blockquote><p>唯一索引</p></blockquote><h3 id="建立唯一索引"><a href="#建立唯一索引" class="headerlink" title="建立唯一索引"></a>建立唯一索引</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 保障 同文档内所有的 id 不能重复</span></span><br><span class="line">db.two.ensureIndex(&#123;<span class="string">"id"</span>:<span class="number">1</span>&#125;,&#123;<span class="string">"unique"</span>:<span class="literal">true</span>&#125;)</span><br></pre></td></tr></table></figure><h3 id="建立-复合唯一索引"><a href="#建立-复合唯一索引" class="headerlink" title="建立 复合唯一索引"></a>建立 复合唯一索引</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据 id username 建立复合索引</span></span><br><span class="line">db.two.ensureIndex(&#123;<span class="string">"id"</span>:<span class="number">1</span>,<span class="attr">username</span>:<span class="number">1</span>&#125;,&#123;<span class="string">"unique"</span>:<span class="literal">true</span>&#125;)</span><br><span class="line"><span class="comment">// 仅能包含三种类型</span></span><br><span class="line">db.two.insert(&#123;<span class="string">"id"</span>:<span class="number">1</span>,<span class="string">"username"</span>:<span class="string">"li"</span>&#125;);</span><br><span class="line">db.two.insert(&#123;<span class="string">"id"</span>:<span class="number">2</span>,<span class="string">"username"</span>:<span class="string">"li"</span>&#125;);</span><br><span class="line">db.two.insert(&#123;<span class="string">"id"</span>:<span class="number">1</span>,<span class="string">"username"</span>:<span class="string">"zhang"</span>&#125;);</span><br></pre></td></tr></table></figure><blockquote><p>稀疏索引</p></blockquote><h3 id="建立稀疏索引"><a href="#建立稀疏索引" class="headerlink" title="建立稀疏索引"></a>建立稀疏索引</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">	</span><br></pre></td></tr></table></figure><h3 id="文档索引嵌套"><a href="#文档索引嵌套" class="headerlink" title="文档索引嵌套"></a>文档索引嵌套</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="string">"name"</span>:<span class="string">'李四'</span>,</span><br><span class="line"><span class="string">"loc"</span>:&#123;</span><br><span class="line">	<span class="string">"ip"</span>:<span class="string">"127.0.0.1"</span>,</span><br><span class="line">	<span class="string">"state"</span>:<span class="string">"NY"</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 根据文档的 state 建立 索引</span></span><br><span class="line">db.two.ensureIndex(&#123;<span class="string">"loc.state"</span>:<span class="number">1</span>&#125;)</span><br></pre></td></tr></table></figure><h3 id="数组文档嵌套索引"><a href="#数组文档嵌套索引" class="headerlink" title="数组文档嵌套索引"></a>数组文档嵌套索引</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[&#123;</span><br><span class="line"><span class="string">"name"</span>:<span class="string">'李四'</span>,</span><br><span class="line"><span class="string">"loc"</span>:&#123;</span><br><span class="line">	<span class="string">"ip"</span>:<span class="string">"127.0.0.1"</span>,</span><br><span class="line">	<span class="string">"state"</span>:<span class="string">"NY"</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;,&#123;</span><br><span class="line"><span class="string">"name"</span>:<span class="string">'李四'</span>,</span><br><span class="line"><span class="string">"loc"</span>:&#123;</span><br><span class="line">	<span class="string">"ip"</span>:<span class="string">"127.0.0.2"</span>,</span><br><span class="line">	<span class="string">"state"</span>:<span class="string">"NY"</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;]</span><br><span class="line"><span class="comment">// 根据数组中的文档建立索引</span></span><br><span class="line">db.two.ensureIndex(&#123;<span class="string">"loc.state"</span>:<span class="number">1</span>&#125;)</span><br></pre></td></tr></table></figure><h2 id="getIndexes-查询已建立的索引"><a href="#getIndexes-查询已建立的索引" class="headerlink" title="getIndexes() 查询已建立的索引"></a>getIndexes() 查询已建立的索引</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">db.two.getIndexes()</span><br><span class="line">[&#123;</span><br><span class="line">               <span class="string">"v"</span> : <span class="number">2</span>,</span><br><span class="line">               <span class="string">"key"</span> : &#123;</span><br><span class="line">                       <span class="string">"_id"</span> : <span class="number">1</span></span><br><span class="line">               &#125;,</span><br><span class="line">               <span class="string">"name"</span> : <span class="string">"_id_"</span>,</span><br><span class="line">               <span class="string">"ns"</span> : <span class="string">"test.two"</span></span><br><span class="line">       &#125;,</span><br><span class="line">       &#123;</span><br><span class="line">               <span class="string">"v"</span> : <span class="number">2</span>,</span><br><span class="line">               <span class="string">"key"</span> : &#123;</span><br><span class="line">                       <span class="string">"name"</span> : <span class="number">1</span></span><br><span class="line">               &#125;,</span><br><span class="line">               <span class="string">"name"</span> : <span class="string">"name_1"</span>,</span><br><span class="line">               <span class="string">"ns"</span> : <span class="string">"test.two"</span></span><br><span class="line">       &#125;]</span><br></pre></td></tr></table></figure><h2 id="dropIndex-删除索引"><a href="#dropIndex-删除索引" class="headerlink" title="dropIndex() 删除索引"></a>dropIndex() 删除索引</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.two.dropIndex(&#123;<span class="string">"name"</span>:<span class="number">1</span>&#125;)</span><br></pre></td></tr></table></figure><table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>v</td><td>内部使用，表示索引版本</td></tr><tr><td>key</td><td>建立的索引</td></tr></tbody></table><h3 id="聚合管道"><a href="#聚合管道" class="headerlink" title="聚合管道"></a>聚合管道</h3><ul><li>$project 增加、删除、重命名字段</li><li>$match 条件匹配</li><li>$limit 限制结果的数量</li><li>$skip 跳过文档的数量</li><li>$sort 条件排序</li><li>$group 条件组合结果统计</li><li>$lookup 引用其他聚合的数据</li><li>$max 获取集合中所有文档对应值得最大值。</li><li>$min 获取集合中所有文档对应值得最小值。</li><li>$sum 计算总和。</li><li>$avg 计算平均值</li><li>$first 根据资源文档的排序获取第一个文档数据。</li><li>$last 根据资源文档的排序获取最后一个文档数据</li></ul><h3 id="使用管道操作-一个对象就是一个-管道"><a href="#使用管道操作-一个对象就是一个-管道" class="headerlink" title="使用管道操作 一个对象就是一个 管道"></a>使用管道操作 一个对象就是一个 管道</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">db.news.aggregate(<span class="string">"users"</span> ,[</span><br><span class="line">    &#123;</span><br><span class="line">        $project:&#123;</span><br><span class="line">          name:<span class="string">"test"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        $sort:&#123;</span><br><span class="line">          id: <span class="number">-1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure><h3 id="使用管道-实现-多表联查"><a href="#使用管道-实现-多表联查" class="headerlink" title="使用管道 实现 多表联查"></a>使用管道 实现 多表联查</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">db.news.aggregate(<span class="string">"users"</span> ,[</span><br><span class="line">    &#123;</span><br><span class="line">        $lookup:&#123;</span><br><span class="line">          <span class="keyword">from</span>: <span class="string">"关联表名"</span>,</span><br><span class="line">          localField: <span class="string">"主表关联字段"</span>,</span><br><span class="line">          foreignField: <span class="string">"副表关联字段"</span>,</span><br><span class="line">          <span class="keyword">as</span>: <span class="string">"把合并到的数据赋值主表给的字段"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure><h3 id="Egg-内使用-多表联查"><a href="#Egg-内使用-多表联查" class="headerlink" title="Egg 内使用 多表联查"></a>Egg 内使用 多表联查</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">app.mongo.aggregate(<span class="string">"users"</span> ,&#123;</span><br><span class="line">  pipeline:[</span><br><span class="line">    &#123;</span><br><span class="line">        $lookup:&#123;</span><br><span class="line">          <span class="keyword">from</span>: <span class="string">"关联表名"</span>,</span><br><span class="line">          localField: <span class="string">"主表关联字段"</span>,</span><br><span class="line">          foreignField: <span class="string">"副表关联字段"</span>,</span><br><span class="line">          <span class="keyword">as</span>: <span class="string">"把合并到的数据赋值主表给的字段"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">  options:&#123;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="explain-查询结果文件描述-必须放在-最后面"><a href="#explain-查询结果文件描述-必须放在-最后面" class="headerlink" title="explain() 查询结果文件描述[必须放在 最后面]"></a>explain() 查询结果文件描述[必须放在 最后面]</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.two.find().explain()</span><br></pre></td></tr></table></figure><h1 id="hint-“-natural”-1-强制全表查询"><a href="#hint-“-natural”-1-强制全表查询" class="headerlink" title=".hint({“$natural”:1}) 强制全表查询"></a>.hint({“$natural”:1}) 强制全表查询</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.two.find().hint(&#123;<span class="string">"$natural"</span>:<span class="number">1</span>&#125;)</span><br></pre></td></tr></table></figure><h1 id="shell-参数说明"><a href="#shell-参数说明" class="headerlink" title="shell 参数说明"></a>shell 参数说明</h1><table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>nMatched</td><td>匹配并修改</td></tr><tr><td>nUpserted</td><td>更新并插入</td></tr><tr><td>nModified</td><td>修改并插入</td></tr></tbody></table><h3 id="Egg-内使用-MongoDB-数据库"><a href="#Egg-内使用-MongoDB-数据库" class="headerlink" title="Egg 内使用 MongoDB 数据库"></a>Egg 内使用 MongoDB 数据库</h3><blockquote><p>使用 原生 MongoDB 数据库，借助 egg-mongo-native 插件<br><a href="https://github.com/brickyang/egg-mongo-native/blob/master/README.zh_CN.md" target="_blank" rel="noopener">egg-mongo-native</a><br>根据 _id 查询数据</p><ul><li>引入 原始的 <code>MongoDB</code> <code>ObjectID</code> 方法<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ObjectID = <span class="built_in">require</span>(<span class="string">'MongoDB'</span>).ObjectID;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> result = <span class="keyword">await</span> app.mongo.find(<span class="string">'name'</span>, &#123; <span class="attr">query</span>: &#123;<span class="string">"_id"</span>:ObjectID(<span class="string">'19279127389172938'</span>)&#125; &#125;);</span><br></pre></td></tr></table></figure></li></ul></blockquote><ul><li>(重点) 将 <code>ObjectID</code> 提取到 <code>this.app</code> 原型链上<ul><li>使用 <code>extend</code> <code>Application</code> 扩展 <code>app</code></li></ul></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;app&#125; = <span class="keyword">this</span>;</span><br><span class="line"><span class="keyword">const</span> result = <span class="keyword">await</span> app.mongo.find(<span class="string">'name'</span>, &#123; <span class="attr">query</span>: &#123;<span class="string">"_id"</span>: app.ObjectID(<span class="string">'19279127389172938'</span>)&#125; &#125;);</span><br></pre></td></tr></table></figure><blockquote><p>使用 ORM 框架 egg-mongoose 操作 MongoDB 数据库<br><a href="https://www.npmjs.com/package/egg-mongoose" target="_blank" rel="noopener">egg-mongoose</a></p></blockquote><div class="post-announce">感谢您的阅读，本文由 <a href="https://18600917746.github.io">cheng</a> 版权所有。如若转载，请注明出处：cheng（<a href="https://18600917746.github.io/2019/01/28/hello-mongoDB/">https://18600917746.github.io/2019/01/28/hello-mongoDB/</a>）</div><div class="post__prevs"><div class="post__prev"><a href="/2019/01/28/super-git/" title="super-git"><i class="iconfont icon-prev"></i>super-git</a></div><div class="post__prev post__prev--right"><a href="/2019/01/28/进程、线程与协程/" title="进程、线程与协程">进程、线程与协程<i class="iconfont icon-next"></i></a></div></div></div></article></div><aside class="page__sidebar"><form id="page-search-from" class="page__search-from" action="/search/"><label class="search-form__item"><input class="input" type="text" name="search" placeholder="Search..."> <i class="iconfont icon-search"></i></label></form><div class="sidebar__block"><h3 class="block__title">简介</h3><p class="block__text">日常学习与兴趣交流的个人博客</p></div><div class="sidebar__block"><h3 class="block__title">文章分类</h3><ul class="block-list"><li class="block-list-item"><a class="block-list-link" href="/categories/茶余饭后/">茶余饭后</a><span class="block-list-count">8</span><ul class="block-list-child"><li class="block-list-item"><a class="block-list-link" href="/categories/茶余饭后/文章/">文章</a><span class="block-list-count">3</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/茶余饭后/数据库/">数据库</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/茶余饭后/排序/">排序</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/茶余饭后/jsCode/">jsCode</a><span class="block-list-count">3</span></li></ul></li><li class="block-list-item"><a class="block-list-link" href="/categories/测试/">测试</a><span class="block-list-count">3</span><ul class="block-list-child"><li class="block-list-item"><a class="block-list-link" href="/categories/测试/抓包/">抓包</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/测试/hello/">hello</a><span class="block-list-count">2</span></li></ul></li><li class="block-list-item"><a class="block-list-link" href="/categories/小程序/">小程序</a><span class="block-list-count">1</span><ul class="block-list-child"><li class="block-list-item"><a class="block-list-link" href="/categories/小程序/原生/">原生</a><span class="block-list-count">1</span></li></ul></li><li class="block-list-item"><a class="block-list-link" href="/categories/后端/">后端</a><span class="block-list-count">10</span><ul class="block-list-child"><li class="block-list-item"><a class="block-list-link" href="/categories/后端/nginx/">nginx</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/后端/hello/">hello</a><span class="block-list-count">7</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/后端/PHP/">PHP</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/后端/Java/">Java</a><span class="block-list-count">1</span><ul class="block-list-child"><li class="block-list-item"><a class="block-list-link" href="/categories/后端/Java/Spring-Boot/">Spring Boot</a><span class="block-list-count">1</span></li></ul></li></ul></li><li class="block-list-item"><a class="block-list-link" href="/categories/前端/">前端</a><span class="block-list-count">27</span><ul class="block-list-child"><li class="block-list-item"><a class="block-list-link" href="/categories/前端/vue/">vue</a><span class="block-list-count">4</span><ul class="block-list-child"><li class="block-list-item"><a class="block-list-link" href="/categories/前端/vue/Vuex/">Vuex</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/前端/vue/Router/">Router</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/前端/vue/Components/">Components</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/前端/vue/Ajax/">Ajax</a><span class="block-list-count">1</span></li></ul></li><li class="block-list-item"><a class="block-list-link" href="/categories/前端/super/">super</a><span class="block-list-count">3</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/前端/hello/">hello</a><span class="block-list-count">16</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/前端/Js/">Js</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/前端/H5/">H5</a><span class="block-list-count">1</span></li></ul></li><li class="block-list-item"><a class="block-list-link" href="/categories/hello/">hello</a><span class="block-list-count">1</span><ul class="block-list-child"><li class="block-list-item"><a class="block-list-link" href="/categories/hello/webpack/">webpack</a><span class="block-list-count">1</span></li></ul></li><li class="block-list-item"><a class="block-list-link" href="/categories/Dart/">Dart</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/App/">App</a><span class="block-list-count">6</span><ul class="block-list-child"><li class="block-list-item"><a class="block-list-link" href="/categories/App/Flutter/">Flutter</a><span class="block-list-count">4</span><ul class="block-list-child"><li class="block-list-item"><a class="block-list-link" href="/categories/App/Flutter/SharedPreference/">SharedPreference</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/App/Flutter/Routes/">Routes</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/App/Flutter/Icon/">Icon</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/App/Flutter/Http/">Http</a><span class="block-list-count">1</span></li></ul></li><li class="block-list-item"><a class="block-list-link" href="/categories/App/Cordova/">Cordova</a><span class="block-list-count">2</span><ul class="block-list-child"><li class="block-list-item"><a class="block-list-link" href="/categories/App/Cordova/Plugin/">Plugin</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/App/Cordova/Platforms/">Platforms</a><span class="block-list-count">1</span></li></ul></li></ul></li></ul></div><div class="sidebar__block"><h3 class="block__title">最新文章</h3><ul class="block-list latest-post-list"><li class="latest-post-item"><a href="/2019/11/14/hello-mongoose/" title="hello-mongoose"><div class="item__cover"><img src="/images/default-bg.jpg" alt="hello-mongoose"></div><div class="item__info"><h3 class="item__title">hello-mongoose</h3><span class="item__text">2019-11-14</span></div></a></li><li class="latest-post-item"><a href="/2019/11/13/史上最全数据库中间件详解/" title="史上最全数据库中间件详解"><div class="item__cover"><img src="/images/default-bg.jpg" alt="史上最全数据库中间件详解"></div><div class="item__info"><h3 class="item__title">史上最全数据库中间件详解</h3><span class="item__text">2019-11-13</span></div></a></li><li class="latest-post-item"><a href="/2019/10/16/hello-nginx/" title="hello-nginx"><div class="item__cover"><img src="/images/default-bg.jpg" alt="hello-nginx"></div><div class="item__info"><h3 class="item__title">hello-nginx</h3><span class="item__text">2019-10-16</span></div></a></li><li class="latest-post-item"><a href="/2019/10/05/js排序/" title="js排序"><div class="item__cover"><img src="/images/default-bg.jpg" alt="js排序"></div><div class="item__info"><h3 class="item__title">js排序</h3><span class="item__text">2019-10-05</span></div></a></li></ul></div><div class="sidebar__block"><h3 class="block__title">文章标签</h3><ul class="block-list tag-list clearfix"><li class="tag-item"><a class="tag-link" href="/tags/Apache/">Apache</a></li><li class="tag-item"><a class="tag-link" href="/tags/App/">App</a></li><li class="tag-item"><a class="tag-link" href="/tags/Bugfree/">Bugfree</a></li><li class="tag-item"><a class="tag-link" href="/tags/Cordova/">Cordova</a></li><li class="tag-item"><a class="tag-link" href="/tags/Dart/">Dart</a></li><li class="tag-item"><a class="tag-link" href="/tags/ES6/">ES6</a></li><li class="tag-item"><a class="tag-link" href="/tags/ES6版本/">ES6版本</a></li><li class="tag-item"><a class="tag-link" href="/tags/Express/">Express</a></li><li class="tag-item"><a class="tag-link" href="/tags/Flutter/">Flutter</a></li><li class="tag-item"><a class="tag-link" href="/tags/Git-服务器/">Git 服务器</a></li><li class="tag-item"><a class="tag-link" href="/tags/H5/">H5</a></li><li class="tag-item"><a class="tag-link" href="/tags/Hash/">Hash</a></li><li class="tag-item"><a class="tag-link" href="/tags/Java/">Java</a></li><li class="tag-item"><a class="tag-link" href="/tags/Js片段/">Js片段</a></li><li class="tag-item"><a class="tag-link" href="/tags/Koa2/">Koa2</a></li><li class="tag-item"><a class="tag-link" href="/tags/Nginx/">Nginx</a></li><li class="tag-item"><a class="tag-link" href="/tags/Node/">Node</a></li><li class="tag-item"><a class="tag-link" href="/tags/NodeJS/">NodeJS</a></li><li class="tag-item"><a class="tag-link" href="/tags/PHP/">PHP</a></li><li class="tag-item"><a class="tag-link" href="/tags/Spring-Boot/">Spring Boot</a></li><li class="tag-item"><a class="tag-link" href="/tags/Svn-服务器/">Svn 服务器</a></li><li class="tag-item"><a class="tag-link" href="/tags/Tomcat/">Tomcat</a></li><li class="tag-item"><a class="tag-link" href="/tags/Vue/">Vue</a></li><li class="tag-item"><a class="tag-link" href="/tags/charles/">charles</a></li><li class="tag-item"><a class="tag-link" href="/tags/css/">css</a></li><li class="tag-item"><a class="tag-link" href="/tags/cssmodules/">cssmodules</a></li><li class="tag-item"><a class="tag-link" href="/tags/fetch/">fetch</a></li><li class="tag-item"><a class="tag-link" href="/tags/flutter/">flutter</a></li><li class="tag-item"><a class="tag-link" href="/tags/formData/">formData</a></li><li class="tag-item"><a class="tag-link" href="/tags/git/">git</a></li><li class="tag-item"><a class="tag-link" href="/tags/gulp/">gulp</a></li><li class="tag-item"><a class="tag-link" href="/tags/html/">html</a></li><li class="tag-item"><a class="tag-link" href="/tags/indexDB/">indexDB</a></li><li class="tag-item"><a class="tag-link" href="/tags/io-js/">io.js</a></li><li class="tag-item"><a class="tag-link" href="/tags/jsCode/">jsCode</a></li><li class="tag-item"><a class="tag-link" href="/tags/js排序/">js排序</a></li><li class="tag-item"><a class="tag-link" href="/tags/linux/">linux</a></li><li class="tag-item"><a class="tag-link" href="/tags/meta/">meta</a></li><li class="tag-item"><a class="tag-link" href="/tags/mongoDB/">mongoDB</a></li><li class="tag-item"><a class="tag-link" href="/tags/mongoose/">mongoose</a></li><li class="tag-item"><a class="tag-link" href="/tags/mysql/">mysql</a></li><li class="tag-item"><a class="tag-link" href="/tags/node-js/">node.js</a></li><li class="tag-item"><a class="tag-link" href="/tags/nodeJS/">nodeJS</a></li><li class="tag-item"><a class="tag-link" href="/tags/pm2/">pm2</a></li><li class="tag-item"><a class="tag-link" href="/tags/shelljs/">shelljs</a></li><li class="tag-item"><a class="tag-link" href="/tags/sort/">sort</a></li><li class="tag-item"><a class="tag-link" href="/tags/typescript/">typescript</a></li><li class="tag-item"><a class="tag-link" href="/tags/vue/">vue</a></li><li class="tag-item"><a class="tag-link" href="/tags/vue-Ajax/">vue-Ajax</a></li><li class="tag-item"><a class="tag-link" href="/tags/vue-Components/">vue-Components</a></li><li class="tag-item"><a class="tag-link" href="/tags/vue-Router/">vue-Router</a></li><li class="tag-item"><a class="tag-link" href="/tags/vue-Vuex/">vue-Vuex</a></li><li class="tag-item"><a class="tag-link" href="/tags/webScoket/">webScoket</a></li><li class="tag-item"><a class="tag-link" href="/tags/webpack/">webpack</a></li><li class="tag-item"><a class="tag-link" href="/tags/名词解释/">名词解释</a></li><li class="tag-item"><a class="tag-link" href="/tags/小程序/">小程序</a></li><li class="tag-item"><a class="tag-link" href="/tags/布局/">布局</a></li><li class="tag-item"><a class="tag-link" href="/tags/抓包/">抓包</a></li><li class="tag-item"><a class="tag-link" href="/tags/测试/">测试</a></li><li class="tag-item"><a class="tag-link" href="/tags/茶余饭后/">茶余饭后</a></li><li class="tag-item"><a class="tag-link" href="/tags/跨域/">跨域</a></li></ul></div></aside></main><footer class="page__footer"><section class="footer__top"><div class="page__container footer__container"><div class="footer-top__item footer-top__item--2"><h3 class="item__title">关于</h3><div class="item__content"><p class="item__text">本站是基于 Hexo 搭建的静态资源博客，主要用于分享日常学习、生活及工作的一些心得总结。</p><ul class="footer__contact-info"><li class="contact-info__item"><i class="iconfont icon-address"></i> <span>BeiJing, China</span></li><li class="contact-info__item"><i class="iconfont icon-email2"></i> <span>18600917746@163.com</span></li></ul></div></div><div class="footer-top__item footer__image"><img src="/images/pay.jpg" alt="logo" title="cheng"></div><div class="footer-top__item"><h3 class="item__title">友情链接</h3><div class="item__content"><ul class="footer-top__list"><li class="list-item"><a href="https://github.com/Mrminfive/hexo-theme-skapp" title="hexo-theme-skapp" target="_blank">hexo-theme-skapp</a></li></ul></div></div><div class="footer-top__item"><h3 class="item__title">构建工具</h3><div class="item__content"><ul class="footer-top__list"><li class="list-item"><a href="https://hexo.io/" title="Blog Framework" target="_blank">Hexo</a></li></ul></div></div></div></section><section class="footer__bottom"><div class="page__container footer__container"><p class="footer__copyright">© <a href="https://github.com/Mrminfive/hexo-theme-skapp" target="_blank">Skapp</a> 2017 powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, made by <a href="https://github.com/Mrminfive" target="_blank">minfive</a>.</p><ul class="footer__social-network clearfix"><li class="social-network__item"><a href="https://github.com/18600917746" target="_blank" title="github"><i class="iconfont icon-github"></i></a></li><li class="social-network__item"><a href="mailto:18600917746@163.com" target="_blank" title="email"><i class="iconfont icon-email"></i></a></li><li class="social-network__item"><a href="/atom.xml" target="_blank" title="rss"><i class="iconfont icon-rss"></i></a></li></ul></div></section></footer><div id="back-top" class="back-top back-top--hidden js-hidden"><i class="iconfont icon-top"></i></div></div><script src="/js/common.js"></script><script src="/js/page/post.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></body></html>